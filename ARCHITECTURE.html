<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Shipping Aggregator — Complete Architecture &amp; Functional Reference | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yash-verma5.github.io/Dynamic-Docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://yash-verma5.github.io/Dynamic-Docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://yash-verma5.github.io/Dynamic-Docs/ARCHITECTURE"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Shipping Aggregator — Complete Architecture &amp; Functional Reference | My Site"><meta data-rh="true" name="description" content="This architectural document includes interactive components like the Carrier Payload Simulator and tabbed code blocks to help you understand the integration boundary."><meta data-rh="true" property="og:description" content="This architectural document includes interactive components like the Carrier Payload Simulator and tabbed code blocks to help you understand the integration boundary."><link data-rh="true" rel="icon" href="/Dynamic-Docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yash-verma5.github.io/Dynamic-Docs/ARCHITECTURE"><link data-rh="true" rel="alternate" href="https://yash-verma5.github.io/Dynamic-Docs/ARCHITECTURE" hreflang="en"><link data-rh="true" rel="alternate" href="https://yash-verma5.github.io/Dynamic-Docs/ARCHITECTURE" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Dynamic-Docs/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Dynamic-Docs/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/Dynamic-Docs/assets/css/styles.c86fd0fa.css">
<script src="/Dynamic-Docs/assets/js/runtime~main.57158e7b.js" defer="defer"></script>
<script src="/Dynamic-Docs/assets/js/main.ec7044b5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Dynamic-Docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Dynamic-Docs/"><div class="navbar__logo"><img src="/Dynamic-Docs/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Dynamic-Docs/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/Dynamic-Docs/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/Dynamic-Docs/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><header><h1>Shipping Aggregator — Complete Architecture &amp; Functional Reference</h1></header>
<!-- -->
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Interactive Guide</div><div class="admonitionContent_BuS1"><p>This architectural document includes interactive components like the Carrier Payload Simulator and tabbed code blocks to help you understand the integration boundary.</p></div></div>
<div id="printable-content"><blockquote>
<p><strong>Scope</strong>: Moqui <code>shipping-aggregator</code> component as deployed in ADOC<br>
<strong>Last updated</strong>: 2026-02-20<br>
<strong>Primary source</strong>: <code>moqui-copy/moqui-framework/runtime/component/shipping-aggregator/</code></p>
</blockquote><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="table-of-contents">Table of Contents<a href="#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents" translate="no">​</a></h2><ol>
<li class=""><a href="#1-system-overview" class="">System Overview</a></li>
<li class=""><a href="#2-moqui--ofbiz-integration-boundary" class="">Moqui ↔ OFBiz Integration Boundary</a></li>
<li class=""><a href="#3-core-architecture-the-plugin-pattern" class="">Core Architecture: The Plugin Pattern</a></li>
<li class=""><a href="#4-entity-model--configuration-data" class="">Entity Model &amp; Configuration Data</a></li>
<li class=""><a href="#5-rest-api-surface" class="">REST API Surface</a></li>
<li class=""><a href="#6-authentication--token-management" class="">Authentication &amp; Token Management</a></li>
<li class=""><a href="#7-label-generation--full-lifecycle" class="">Label Generation — Full Lifecycle</a></li>
<li class=""><a href="#8-rate-shopping--full-lifecycle" class="">Rate Shopping — Full Lifecycle</a></li>
<li class=""><a href="#9-label-voiding-refund--full-lifecycle" class="">Label Voiding (Refund) — Full Lifecycle</a></li>
<li class=""><a href="#10-webhook--order-status-callback" class="">Webhook / Order Status Callback</a></li>
<li class=""><a href="#11-carrier-integration-details" class="">Carrier Integration Details</a></li>
<li class=""><a href="#12-error-handling--logging" class="">Error Handling &amp; Logging</a></li>
<li class=""><a href="#13-configuration-reference" class="">Configuration Reference</a></li>
</ol><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-system-overview">1. System Overview<a href="#1-system-overview" class="hash-link" aria-label="Direct link to 1. System Overview" title="Direct link to 1. System Overview" translate="no">​</a></h2><p>The <strong>Shipping Aggregator</strong> is a Moqui framework component that acts as a <strong>carrier-agnostic shipping gateway hub</strong>. It receives shipping requests from OFBiz OMS (via REST HTTP calls), resolves the correct carrier and configuration from the requesting user&#x27;s identity, then invokes a carrier-specific implementation, normalizes the response, and returns it to OFBiz.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌───────────────────────┐         HTTP REST          ┌────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                       │ ─────────────────────────► │   Moqui: shipping-aggregator component     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   OFBiz OMS           │                            │                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (order management,   │ ◄───────────────────────── │  ┌──────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   fulfillment,        │    JSON response map        │  │ GenericShippingServices.xml           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   label printing)     │                            │  │  - get#ShippingRate                  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                       │                            │  │  - request#ShippingLabel             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└───────────────────────┘                            │  │  - refund#ShippingLabel              │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  │  - get#Manifest                      │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  │  - post#Order / delete#Order         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  │  - get#Departments / Municipalities  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  │  - post#OrderStatus (webhook in)     │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  └──────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │                    │                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │                    ▼                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  ┌──────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  │ get#ShippingGatewayDetails           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  │ (resolves carrier from user identity)│  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │  └──────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │                    │                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         ┌──────────▼────────────┐          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         │  Carrier Service       │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         │ (dynamic dispatch via  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         │  ShippingGatewayConfig)│          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         └──────────┬────────────┘          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │                    │                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         ┌──────────▼────────────┐          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         │  GenericHandlerService │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         │ (optional normalizer)  │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     │         └───────────────────────┘          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                     └────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        ┌────────────┬────────────────────┼──────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        ▼            ▼                    ▼              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     FORZA         C807           TERMINAL_EXPRESS    MOOVIN / DRIVIN / etc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  (Guatemala)   (Honduras,SV)    (Costa Rica)        (other carriers)</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-design-decisions">Key Design Decisions<a href="#key-design-decisions" class="hash-link" aria-label="Direct link to Key Design Decisions" title="Direct link to Key Design Decisions" translate="no">​</a></h3><table><thead><tr><th>Decision</th><th>Implementation</th></tr></thead><tbody><tr><td><strong>Carrier routing</strong></td><td>Based on user&#x27;s <code>partyId</code> → <code>PartyRelationship</code> → <code>ShippingGatewayConfigId</code> setting</td></tr><tr><td><strong>Service dispatch</strong></td><td>Dynamic — service names stored in DB (<code>ShippingGatewayConfig</code>, <code>ShippingGatewayOption</code>)</td></tr><tr><td><strong>Authentication</strong></td><td>Centralized <code>get#Token</code> with distributed cache (no re-auth per request)</td></tr><tr><td><strong>Response normalization</strong></td><td>Optional per-carrier handler via <code>ShippingGatewayOption</code> (<code>service.name.handle.get.label</code>, etc.)</td></tr><tr><td><strong>Multi-tenancy</strong></td><td>Each tenant (ADOC, ADOC_HN, ADOC_SV) has separate <code>PartyRelationship</code> and settings</td></tr></tbody></table><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-moqui--ofbiz-integration-boundary">2. Moqui ↔ OFBiz Integration Boundary<a href="#2-moqui--ofbiz-integration-boundary" class="hash-link" aria-label="Direct link to 2. Moqui ↔ OFBiz Integration Boundary" title="Direct link to 2. Moqui ↔ OFBiz Integration Boundary" translate="no">​</a></h2><p>OFBiz and Moqui are <strong>separate applications</strong> that communicate over HTTP REST. OFBiz acts as the API consumer; Moqui acts as the shipping service provider.</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-ofbiz-calls-moqui">How OFBiz Calls Moqui<a href="#how-ofbiz-calls-moqui" class="hash-link" aria-label="Direct link to How OFBiz Calls Moqui" title="Direct link to How OFBiz Calls Moqui" translate="no">​</a></h3><p>OFBiz constructs a REST <code>POST</code> request with a JSON body and an <code>Authorization: Basic &lt;base64&gt;</code> header. The request is sent to one of Moqui&#x27;s <code>shipping.rest.xml</code> endpoints.</p><p><strong>Authentication header</strong>: OFBiz authenticates using Moqui user credentials. Each ADOC instance has a dedicated Moqui <code>UserAccount</code> (e.g., <code>adoc</code>, <code>adochn</code>, <code>adocsv</code>) whose <code>partyId</code> determines the carrier lookup.</p><p><strong>Key Moqui user accounts per instance:</strong></p><table><thead><tr><th>Moqui UserAccount</th><th>Username</th><th>Party ID</th><th>Instance</th></tr></thead><tbody><tr><td><code>ADOC</code></td><td><code>adoc</code></td><td><code>ADOC</code></td><td>Guatemala/main</td></tr><tr><td><code>ADOC_HN</code></td><td><code>adochn</code></td><td><code>ADOC_HN</code></td><td>Honduras</td></tr><tr><td><code>ADOC_SV</code></td><td><code>adocsv</code></td><td><code>ADOC_SV</code></td><td>El Salvador</td></tr></tbody></table><div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Critical Identity Logic</div><div class="admonitionContent_BuS1"><p>The <code>partyId</code> of the logged-in Moqui user is the anchor for all carrier resolution. This is set at the time of the REST call via the <code>Authorization</code> header.</p></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="data-ofbiz-sends-to-moqui">Data OFBiz Sends to Moqui<a href="#data-ofbiz-sends-to-moqui" class="hash-link" aria-label="Direct link to Data OFBiz Sends to Moqui" title="Direct link to Data OFBiz Sends to Moqui" translate="no">​</a></h3><p>OFBiz enriches the request with data pulled from its own entities:</p><table><thead><tr><th>Field Category</th><th>Fields Sent</th><th>Source in OFBiz</th></tr></thead><tbody><tr><td><strong>Origin address</strong></td><td><code>toName</code>, <code>address1</code>, <code>address2</code>, <code>city</code>, <code>stateOrProvinceCode</code>, <code>countryCode</code>, <code>phoneNumber</code>, <code>emailAddress</code>, <code>warehouseId</code></td><td>Facility postal address</td></tr><tr><td><strong>Destination address</strong></td><td><code>toName</code>, <code>address1</code>, <code>address2</code>, <code>city</code>, <code>stateOrProvinceCode</code>, <code>province</code>, <code>canton</code>, <code>district</code>, <code>countryCode</code>, <code>phoneNumber</code>, <code>emailAddress</code>, <code>stateName</code></td><td>Order ship-to address + order attributes</td></tr><tr><td><strong>Parcels</strong></td><td><code>weight</code>, <code>weightUnit</code>, <code>weightUomId</code>, <code>length</code>, <code>width</code>, <code>height</code>, <code>currency</code>, <code>fragile</code></td><td>Shipment packages</td></tr><tr><td><strong>Order info</strong></td><td><code>orderId</code>, <code>orderName</code>, <code>orderNumber</code>, <code>orderDate</code>, <code>ticketNumber</code>, <code>dateOfSale</code></td><td>Order header</td></tr><tr><td><strong>Business rules</strong></td><td><code>cod</code> (boolean), <code>validShipmentTotal</code>, <code>paymentStatusId</code>, <code>shipmentMethodTypeId</code></td><td>Order payment + fulfillment</td></tr><tr><td><strong>Carrier hint</strong></td><td><code>carrierPartyId</code> (optional)</td><td>Carrier assignment</td></tr></tbody></table><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="data-moqui-returns-to-ofbiz">Data Moqui Returns to OFBiz<a href="#data-moqui-returns-to-ofbiz" class="hash-link" aria-label="Direct link to Data Moqui Returns to OFBiz" title="Direct link to Data Moqui Returns to OFBiz" translate="no">​</a></h3><p>Moqui always returns a <code>responseMap</code> JSON object. Successful responses include:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;shippingLabelMap&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;referenceNumber&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;packages&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;trackingIdNumber&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;TRK001&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;artifacts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> ... </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div><p>Error responses:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errorMessages&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;No carrier found&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-core-architecture-the-plugin-pattern">3. Core Architecture: The Plugin Pattern<a href="#3-core-architecture-the-plugin-pattern" class="hash-link" aria-label="Direct link to 3. Core Architecture: The Plugin Pattern" title="Direct link to 3. Core Architecture: The Plugin Pattern" translate="no">​</a></h2><p>Every top-level generic service follows the <strong>same 5-step pipeline</strong>:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. get#ShippingGatewayDetails   → Resolve carrier from user identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. validate#RequiredParameters  → Validate mandatory inputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. ShippingGatewayConfig lookup → Find the right carrier service name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Dynamic carrier service call → Invoke carrier-specific implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. GenericHandlerServices call  → Optional carrier-specific response normalization</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1--getshippinggatewaydetails">Step 1 — <code>get#ShippingGatewayDetails</code><a href="#step-1--getshippinggatewaydetails" class="hash-link" aria-label="Direct link to step-1--getshippinggatewaydetails" title="Direct link to step-1--getshippinggatewaydetails" translate="no">​</a></h3><p>This is the carrier resolution <strong>keystone</strong> service. It is <code>allow-remote=&quot;false&quot;</code> (internal only).</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Pseudocode of the logic --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userPartyId = ec.user.userAccount.partyId  // from HTTP Basic Auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (carrierPartyId is null):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lookup PartyRelationship WHERE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fromPartyId  = userPartyId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fromRoleTypeId = &quot;Client&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        toRoleTypeId   = &quot;Carrier&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        relationshipTypeEnumId = &quot;DefaultCarrier&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lookup PartyRelationship WHERE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fromPartyId  = userPartyId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fromRoleTypeId = &quot;Client&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        toPartyId    = carrierPartyId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        toRoleTypeId   = &quot;Carrier&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        relationshipTypeEnumId = &quot;ClientCarrier&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lookup PartyRelationshipSetting WHERE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    partyRelationshipId = partyRelationship.partyRelationshipId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    partySettingTypeId  = &quot;ShippingGatewayConfigId&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  success: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userPartyId, carrierPartyId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  partyRelationshipId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shippingGatewayConfigId: partyRelationshipSetting.settingValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div><p><strong>Entity flow diagram:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">UserAccount.partyId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PartyRelationship  ──────────────────────────────────────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fromPartyId = userPartyId (Client role)                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  toPartyId   = carrierPartyId (Carrier role)                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  relationshipTypeEnumId = &quot;ClientCarrier&quot; (or &quot;DefaultCarrier&quot;)                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ▼                        yields partyRelationshipId                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PartyRelationshipSetting                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  partySettingTypeId = &quot;ShippingGatewayConfigId&quot;                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  settingValue = &quot;FORZA&quot; / &quot;C807&quot; / &quot;TERMINAL_EXPRESS&quot; / ...         ──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ShippingGatewayConfig.shippingGatewayConfigId = settingValue</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3--service-name-resolution-via-shippinggatewayconfig">Step 3 — Service Name Resolution via ShippingGatewayConfig<a href="#step-3--service-name-resolution-via-shippinggatewayconfig" class="hash-link" aria-label="Direct link to Step 3 — Service Name Resolution via ShippingGatewayConfig" title="Direct link to Step 3 — Service Name Resolution via ShippingGatewayConfig" translate="no">​</a></h3><p>For <strong>label requests</strong>, the service name comes from <code>ShippingGatewayConfig.requestLabelsServiceName</code>:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ShippingGatewayConfig</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">shippingGatewayConfigId</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">FORZA</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">requestLabelsServiceName</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">co.hotwax.shippingAggregator.forza.ForzaServices.request#ForzaShippingLabel</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">getRateServiceName</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">co.hotwax.shippingAggregator.forza.ForzaServices.get#ForzaShippingRate</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">refundLabelsServiceName</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">co.hotwax.shippingAggregator.forza.ForzaServices.refund#ForzaShippingLabel</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre></div></div><p>For <strong>extended operations</strong> (manifest, postOrder, deleteOrder, departments, municipalities), the service name comes from <code>ShippingGatewayOption</code>:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ShippingGatewayOption</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">shippingGatewayConfigId</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">C807</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">optionEnumId</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">service.name.get.manifest</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">optionValue</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">co.hotwax.shippingAggregator.c807.C807Services.get#C807Manifest</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4--dynamic-dispatch">Step 4 — Dynamic Dispatch<a href="#step-4--dynamic-dispatch" class="hash-link" aria-label="Direct link to Step 4 — Dynamic Dispatch" title="Direct link to Step 4 — Dynamic Dispatch" translate="no">​</a></h3><p>Moqui&#x27;s service engine resolves service names at runtime:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">service-call</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">${shippingGatewayConfig.requestLabelsServiceName}</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">out-map</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">responseMap</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">in-map</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">context</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre></div></div><p>The entire <code>context</code> (all input parameters) is passed through to the carrier service. No filtering — carriers pick what they need.</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-5--handler-normalization">Step 5 — Handler Normalization<a href="#step-5--handler-normalization" class="hash-link" aria-label="Direct link to Step 5 — Handler Normalization" title="Direct link to Step 5 — Handler Normalization" translate="no">​</a></h3><p>After the carrier call completes, a <strong>handler service</strong> is optionally invoked using a <code>ShippingGatewayOption</code>:</p><table><thead><tr><th>Handler Option Enum</th><th>Purpose</th></tr></thead><tbody><tr><td><code>service.name.handle.get.label</code></td><td>Normalizes label response</td></tr><tr><td><code>service.name.handle.get.rate</code></td><td>Normalizes rate response</td></tr><tr><td><code>service.name.handle.void.label</code></td><td>Normalizes void response</td></tr><tr><td><code>service.name.handle.post.order</code></td><td>Normalizes post-order response</td></tr><tr><td><code>service.name.handle.delete.order</code></td><td>Normalizes delete-order response</td></tr><tr><td><code>service.name.handle.get.manifest</code></td><td>Normalizes manifest response</td></tr><tr><td><code>service.name.handle.get.departments</code></td><td>Normalizes departments response</td></tr><tr><td><code>service.name.handle.get.municipalities</code></td><td>Normalizes municipalities response</td></tr><tr><td><code>service.name.handle.webhook.response</code></td><td>Handles inbound carrier webhook</td></tr></tbody></table><p>If no handler option is configured, the raw carrier response is returned as-is.</p><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-entity-model--configuration-data">4. Entity Model &amp; Configuration Data<a href="#4-entity-model--configuration-data" class="hash-link" aria-label="Direct link to 4. Entity Model &amp; Configuration Data" title="Direct link to 4. Entity Model &amp; Configuration Data" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-mantle-entities-used">Core Mantle Entities Used<a href="#core-mantle-entities-used" class="hash-link" aria-label="Direct link to Core Mantle Entities Used" title="Direct link to Core Mantle Entities Used" translate="no">​</a></h3><table><thead><tr><th>Entity</th><th>Key Fields</th><th>Purpose</th></tr></thead><tbody><tr><td><code>mantle.party.Party</code></td><td><code>partyId</code>, <code>partyTypeEnumId</code></td><td>Represents clients (ADOC) and carriers (FORZA, C807, etc.)</td></tr><tr><td><code>mantle.party.PartyRelationship</code></td><td><code>fromPartyId</code>, <code>toPartyId</code>, <code>relationshipTypeEnumId</code>, <code>partyRelationshipId</code></td><td>Links a client party to a carrier party</td></tr><tr><td><code>mantle.party.PartyRelationshipSetting</code></td><td><code>partyRelationshipId</code>, <code>partySettingTypeId</code>, <code>settingValue</code></td><td>Stores per-relationship credential/config key-value pairs</td></tr><tr><td><code>mantle.shipment.carrier.ShippingGatewayConfig</code></td><td><code>shippingGatewayConfigId</code>, <code>requestLabelsServiceName</code>, <code>getRateServiceName</code>, <code>refundLabelsServiceName</code></td><td>Maps a carrier config ID to its service implementations</td></tr><tr><td><code>mantle.shipment.carrier.ShippingGatewayOption</code></td><td><code>shippingGatewayConfigId</code>, <code>optionEnumId</code>, <code>optionValue</code></td><td>Stores carrier-specific endpoint URLs and handler service names</td></tr><tr><td><code>mantle.shipment.carrier.ShippingGatewayCarrier</code></td><td><code>shippingGatewayConfigId</code>, <code>carrierPartyId</code></td><td>Links a gateway config to a carrier party (used for token cache key)</td></tr><tr><td><code>moqui.security.UserAccount</code></td><td><code>userId</code>, <code>username</code>, <code>partyId</code></td><td>Moqui user that represents each OFBiz tenant instance</td></tr></tbody></table><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="partysettingtype-values"><code>PartySettingType</code> Values<a href="#partysettingtype-values" class="hash-link" aria-label="Direct link to partysettingtype-values" title="Direct link to partysettingtype-values" translate="no">​</a></h3><p>These are the keys used in <code>PartyRelationshipSetting</code>. Each is loaded by <code>TypeData.xml</code>:</p><table><thead><tr><th>Setting Key</th><th>Description</th><th>Used By</th></tr></thead><tbody><tr><td><code>ShippingGatewayConfigId</code></td><td><strong>Required</strong> — resolves which gateway config to use</td><td>All carriers</td></tr><tr><td><code>Username</code></td><td>API username</td><td>C807, TerminalExpress, Moovin</td></tr><tr><td><code>Password</code></td><td>API password</td><td>C807, TerminalExpress, Moovin</td></tr><tr><td><code>ClientId</code></td><td>API client ID</td><td>C807, TerminalExpress, Forza, CargoTrans</td></tr><tr><td><code>ClientSecretKey</code></td><td>OAuth2 client secret or HMAC key</td><td>Forza, CargoTrans</td></tr><tr><td><code>CodApp</code></td><td>Forza-specific &quot;app&quot; identifier</td><td>Forza</td></tr><tr><td><code>AccountNumber</code></td><td>Carrier account number</td><td>Forza</td></tr><tr><td><code>CodeOfReference</code></td><td>Default facility code (overridable by <code>facilityIdentification</code>)</td><td>Forza</td></tr><tr><td><code>ReverseLogistics</code></td><td>Y/N flag for return shipment</td><td>TerminalExpress</td></tr><tr><td><code>ApiKey</code></td><td>Raw API key</td><td>CitiExpress</td></tr><tr><td><code>ApiToken</code></td><td>Bearer-style token</td><td>Drivin</td></tr><tr><td><code>EndPoint</code></td><td>Override base URL for the carrier API</td><td>C807, (others optional)</td></tr><tr><td><code>AuthType</code></td><td><code>BASIC_AUTH</code> or <code>OAUTH2</code></td><td>Used by <code>get#Token</code></td></tr><tr><td><code>SendSharedSecretKey</code></td><td>Refresh token for OAuth2 token refresh</td><td>OAuth2 flow</td></tr><tr><td><code>ClientUrl</code></td><td>OFBiz base URL (for webhook callback)</td><td>C807 (SV, HN)</td></tr><tr><td><code>ClientOrderEndpoint</code></td><td>OFBiz endpoint path for status callbacks</td><td>C807 (SV, HN)</td></tr><tr><td><code>ClientAuthKey</code></td><td>Base64 Basic auth for callback to OFBiz</td><td>C807 (SV, HN)</td></tr><tr><td><code>LabelType</code></td><td>Label format type</td><td>varies</td></tr><tr><td><code>PaymentType</code></td><td>Payment type code</td><td>varies</td></tr></tbody></table><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shippinggatewayoption-optionenumid-values"><code>ShippingGatewayOption</code> <code>optionEnumId</code> Values<a href="#shippinggatewayoption-optionenumid-values" class="hash-link" aria-label="Direct link to shippinggatewayoption-optionenumid-values" title="Direct link to shippinggatewayoption-optionenumid-values" translate="no">​</a></h3><p>These control endpoint URLs and extended service names:</p><table><thead><tr><th>Option Enum ID</th><th>Typical Value Type</th><th>Example</th></tr></thead><tbody><tr><td><code>endPoint</code></td><td>Base URL of carrier API</td><td><code>https://api.forza.com/</code></td></tr><tr><td><code>endPoint.accessToken</code></td><td>Token endpoint path</td><td><code>/oauth/token</code></td></tr><tr><td><code>endPoint.shipment.rate</code></td><td>Rate query path</td><td><code>/rates</code></td></tr><tr><td><code>endPoint.shipments.labels</code></td><td>Label creation path</td><td><code>/labels</code> or <code>Paquetes/crearOrden/</code></td></tr><tr><td><code>endPoint.shipments.void</code></td><td>Void label path</td><td><code>/labels/{id}/void</code></td></tr><tr><td><code>endPoint.shipments.manifest</code></td><td>Manifest path</td><td><code>/manifests</code></td></tr><tr><td><code>endPoint.municipalities</code></td><td>Municipality lookup path</td><td><code>/municipalities</code></td></tr><tr><td><code>endPoint.departments</code></td><td>Department lookup path</td><td><code>/departments</code></td></tr><tr><td><code>endPoint.post.order</code></td><td>Post order path</td><td><code>/orders</code></td></tr><tr><td><code>endPoint.delete.order</code></td><td>Delete order path</td><td><code>/orders/{id}</code></td></tr><tr><td><code>service.name.handle.get.label</code></td><td>Handler service for label response</td><td><code>...handle#C807LabelResponseHandler</code></td></tr><tr><td><code>service.name.handle.get.rate</code></td><td>Handler service for rate response</td><td><code>...handle#ForzaRateResponseHandler</code></td></tr><tr><td><code>service.name.handle.void.label</code></td><td>Handler service for void response</td><td><code>...handle#C807VoidLabelResponseHandler</code></td></tr><tr><td><code>service.name.handle.webhook.response</code></td><td>Handler for inbound webhooks</td><td><code>...handle#C807WebhookResponseHandler</code></td></tr><tr><td><code>LabelRequestTemplate</code></td><td>Template enum</td><td>FTL template path</td></tr></tbody></table><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-rest-api-surface">5. REST API Surface<a href="#5-rest-api-surface" class="hash-link" aria-label="Direct link to 5. REST API Surface" title="Direct link to 5. REST API Surface" translate="no">​</a></h2><p>File: <code>service/shipping.rest.xml</code><br>
<!-- -->All endpoints use <code>require-authentication=&quot;anonymous-all&quot;</code> — meaning OFBiz passes credentials via <code>Authorization: Basic &lt;base64(user:pass)&gt;</code>.</p><table><thead><tr><th>HTTP Method</th><th>Path</th><th>Moqui Service</th></tr></thead><tbody><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/shippingRate</code></td><td><code>GenericShippingServices.get#ShippingRate</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/shippingLabel</code></td><td><code>GenericShippingServices.request#ShippingLabel</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/manifest</code></td><td><code>GenericShippingServices.get#Manifest</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/refundShippingLabel</code></td><td><code>GenericShippingServices.refund#ShippingLabel</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/postOrder</code></td><td><code>GenericShippingServices.post#Order</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/deleteOrder</code></td><td><code>GenericShippingServices.delete#Order</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/getDepartments</code></td><td><code>GenericShippingServices.get#Departments</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/getMunicipalities</code></td><td><code>GenericShippingServices.get#Municipalities</code></td></tr><tr><td><code>POST</code></td><td><code>/rest/s1/shipping/orderStatus</code></td><td><code>GenericShippingServices.post#OrderStatus</code></td></tr></tbody></table><p>Party REST (<code>party.rest.xml</code>): Standard Mantle party management endpoints (find/create parties, roles) — not shipping-specific.</p><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-authentication--token-management">6. Authentication &amp; Token Management<a href="#6-authentication--token-management" class="hash-link" aria-label="Direct link to 6. Authentication &amp; Token Management" title="Direct link to 6. Authentication &amp; Token Management" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h3><p>Carriers use different authentication mechanisms. The system centralizes token acquisition in <code>HelperServices.get#Token</code>.</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="gettoken-flow"><code>get#Token</code> Flow<a href="#gettoken-flow" class="hash-link" aria-label="Direct link to gettoken-flow" title="Direct link to gettoken-flow" translate="no">​</a></h3><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Check distributed cache:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   key = &quot;${partyRelationshipId}_accessToken&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   cache name = carrierPartyId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Cache HIT + isRefresh=false → return cached token immediately (no API call)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Cache MISS or isRefresh=true:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   a. Load ShippingGatewayConfigOptions (endPoints) and PartyRelationshipSettings (credentials)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   b. Read settingsMap[&#x27;AuthType&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;BASIC_AUTH&quot; → restClient.basicAuth(username, password)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - otherwise (OAuth2):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if SendSharedSecretKey present:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            grant_type=refresh_token, refresh_token=&lt;SendSharedSecretKey&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          elif password present:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            grant_type=password, username=..., password=...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            grant_type=client_credentials, client_id=..., client_secret=...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   c. POST to: (settingsMap.EndPoint OR optionsMap.endPoint) + optionsMap[&#x27;endPoint.accessToken&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   d. On 2xx: cache access_token in distributed cache (putIfAbsent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   e. Return { success: true, access_token: &quot;...&quot; }</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="carrier-auth-patterns">Carrier Auth Patterns<a href="#carrier-auth-patterns" class="hash-link" aria-label="Direct link to Carrier Auth Patterns" title="Direct link to Carrier Auth Patterns" translate="no">​</a></h3><div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Forza</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">C807</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Terminal Express</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Moovin / Drivin / CitiExpress...</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><strong>Auth Method:</strong> HMAC-SHA256 signature (<code>LauValue</code> header) + Base64 payload encoding
<strong>Cache Strategy:</strong> No token needed — signature computed per request</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Auth Method:</strong> OAuth2 Bearer token
<strong>Cache Strategy:</strong> Cached per <code>partyRelationshipId</code></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Auth Method:</strong> HTTP Basic Auth (<code>username:password</code>)
<strong>Cache Strategy:</strong> No token needed — sent per request</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li class=""><strong>Moovin</strong>: OAuth2 or Basic Auth (Cached if OAuth2)</li>
<li class=""><strong>CitiExpress</strong>: API Key in header (No token needed)</li>
<li class=""><strong>Drivin</strong>: Bearer API Token (static) (Stored in <code>ApiToken</code> setting)</li>
<li class=""><strong>CargoTrans</strong>: OAuth2 client_credentials (Cached)</li>
</ul></div></div></div><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-label-generation--full-lifecycle">7. Label Generation — Full Lifecycle<a href="#7-label-generation--full-lifecycle" class="hash-link" aria-label="Direct link to 7. Label Generation — Full Lifecycle" title="Direct link to 7. Label Generation — Full Lifecycle" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="entry-point">Entry Point<a href="#entry-point" class="hash-link" aria-label="Direct link to Entry Point" title="Direct link to Entry Point" translate="no">​</a></h3><p>OFBiz POSTs to <code>/rest/s1/shipping/shippingLabel</code> with a JSON body containing shipment data.</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-input-fields">Required Input Fields<a href="#required-input-fields" class="hash-link" aria-label="Direct link to Required Input Fields" title="Direct link to Required Input Fields" translate="no">​</a></h3><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Source</th></tr></thead><tbody><tr><td><code>originAddress.toName</code></td><td>String</td><td>Yes</td><td>Facility name</td></tr><tr><td><code>originAddress.address1</code></td><td>String</td><td>Yes</td><td>Facility address</td></tr><tr><td><code>originAddress.city</code></td><td>String</td><td>Yes</td><td>Facility city</td></tr><tr><td><code>originAddress.stateOrProvinceCode</code></td><td>String</td><td>Yes (Forza)</td><td>Facility state code</td></tr><tr><td><code>originAddress.countryCode</code></td><td>String</td><td>Yes</td><td>Facility country</td></tr><tr><td><code>originAddress.phoneNumber</code></td><td>String</td><td>Yes (some)</td><td>Facility phone</td></tr><tr><td><code>originAddress.warehouseId</code></td><td>String</td><td>Yes (TerminalExpress)</td><td>Carrier warehouse ID</td></tr><tr><td><code>destAddress.toName</code></td><td>String</td><td>Yes</td><td>Customer name</td></tr><tr><td><code>destAddress.address1</code></td><td>String</td><td>Yes</td><td>Shipping address</td></tr><tr><td><code>destAddress.city</code></td><td>String</td><td>Yes</td><td>Customer city</td></tr><tr><td><code>destAddress.stateOrProvinceCode</code></td><td>String</td><td>Yes</td><td>State code</td></tr><tr><td><code>destAddress.province</code></td><td>String</td><td>Yes (TerminalExpress)</td><td>Province name</td></tr><tr><td><code>destAddress.canton</code></td><td>String</td><td>Yes (TerminalExpress)</td><td>Canton</td></tr><tr><td><code>destAddress.district</code></td><td>String</td><td>Yes (TerminalExpress)</td><td>District</td></tr><tr><td><code>destAddress.phoneNumber</code></td><td>String</td><td>Yes</td><td>Customer phone</td></tr><tr><td><code>destAddress.emailAddress</code></td><td>String</td><td>Rec.</td><td>Customer email</td></tr><tr><td><code>destAddress.stateName</code></td><td>String</td><td>Yes (C807)</td><td>State name for C807 lookup</td></tr><tr><td><code>parcels</code></td><td>List</td><td>Yes</td><td>Array of <code>{weight, weightUnit, length, width, height}</code></td></tr><tr><td><code>weightAmount</code></td><td>Decimal</td><td>Yes</td><td>Total shipment weight</td></tr><tr><td><code>dateOfSale</code></td><td>String</td><td>Yes (most)</td><td>Shipment date (YYYY-MM-DD)</td></tr><tr><td><code>orderId</code></td><td>String</td><td>Optional</td><td>OFBiz order ID</td></tr><tr><td><code>orderName</code></td><td>String</td><td>Yes (C807)</td><td>Order reference name</td></tr><tr><td><code>orderNumber</code></td><td>String</td><td>Yes (Forza, digits only)</td><td>Carrier order number</td></tr><tr><td><code>cod</code></td><td>String &quot;true&quot;/&quot;false&quot;</td><td>Yes</td><td>Cash on delivery flag</td></tr><tr><td><code>validShipmentTotal</code></td><td>Decimal</td><td>COD only</td><td>COD amount</td></tr><tr><td><code>paymentStatusId</code></td><td>String</td><td>Yes (C807)</td><td><code>PAYMENT_NOT_RECEIVED</code> etc.</td></tr><tr><td><code>shipmentMethodTypeId</code></td><td>String</td><td>Yes (C807)</td><td><code>SHIP_TO_STORE</code> etc.</td></tr><tr><td><code>facilityIdentification</code></td><td>String</td><td>Optional</td><td>Overrides <code>CodeOfReference</code></td></tr></tbody></table><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-call-sequence">Complete Call Sequence<a href="#complete-call-sequence" class="hash-link" aria-label="Direct link to Complete Call Sequence" title="Direct link to Complete Call Sequence" translate="no">​</a></h3><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="interactive-payload-simulator">Interactive Payload Simulator<a href="#interactive-payload-simulator" class="hash-link" aria-label="Direct link to Interactive Payload Simulator" title="Direct link to Interactive Payload Simulator" translate="no">​</a></h3><p>Use the simulator below to explore how the Generic payload structures adapt into Custom Carrier payloads for a Label Request.</p><div style="border:1px solid var(--ifm-color-emphasis-200);border-radius:8px;padding:16px;margin-bottom:16px"><h3>Label Payload Simulator</h3><p>Select a carrier to view their required payload structure and authentication method.</p><div style="margin-bottom:16px"><label style="display:block;margin-bottom:8px;font-weight:bold">Carrier Network:</label><div style="display:flex;gap:8px;flex-wrap:wrap"><button class="button button--primary" style="padding:8px 16px">FORZA (Guatemala)</button><button class="button button--secondary" style="padding:8px 16px">C807 (Honduras, El Salvador)</button><button class="button button--secondary" style="padding:8px 16px">Terminal Express (Costa Rica)</button></div></div><div style="display:grid;grid-template-columns:1fr;gap:16px;margin-bottom:16px"><div style="padding:12px;background:var(--ifm-color-danger-contrast-background);border-radius:4px;border-left:4px solid var(--ifm-color-danger)"><strong>Authentication:</strong> <!-- -->HMAC-SHA256 signature (LauValue header) + Base64 payload encoding</div><div style="padding:12px;background:var(--ifm-background-color);border-radius:4px;border-left:4px solid var(--ifm-color-primary)"><strong>Key Differences:</strong> <!-- -->Requires State/Province code extraction and custom Municipality/Township resolution. Returns an order number that must be digits only.</div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">FORZA (Guatemala) Label Request Payload</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Method&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/Paquetes/Crear&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Params&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;DateOfSale&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2026-02-21&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ContentDescription&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Apparel Order&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;from_address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Warehouse GT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;phone&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0000-0000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;email&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;warehouse@adoc.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;address1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Zona 1, Ciudad&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;headerCodeTownship&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10101&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;city&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Guatemala&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;to_address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Juan Perez&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;phone&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1111-2222&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;email&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;juan@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;address1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Calle Principal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;headerCodeTownship&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10101&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;city&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Guatemala&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Parcels&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Weight&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Length&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Width&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Height&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Order_Number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2024001&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;IdCountry&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;CountPieces&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;CodeOfReference&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;357506&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TotalWeight&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TotalValue&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Currency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="per-carrier-label-request-construction">Per-Carrier Label Request Construction<a href="#per-carrier-label-request-construction" class="hash-link" aria-label="Direct link to Per-Carrier Label Request Construction" title="Direct link to Per-Carrier Label Request Construction" translate="no">​</a></h3><h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="forza-guatemala">Forza (Guatemala)<a href="#forza-guatemala" class="hash-link" aria-label="Direct link to Forza (Guatemala)" title="Direct link to Forza (Guatemala)" translate="no">​</a></h4><p><strong>Validation:</strong></p><ul>
<li class=""><code>shippingGatewayConfigId</code>, <code>dateOfSale</code>, <code>weightAmount</code>, <code>countryId</code>, <code>parcels</code>, <code>destAddress</code>, <code>originAddress</code> must be present</li>
<li class=""><code>orderNumber</code> must be digits only</li>
<li class=""><code>originAddress.stateOrProvinceCode</code> and <code>destAddress.stateOrProvinceCode</code> must be present</li>
</ul><p><strong>Municipality resolution:</strong></p><ol>
<li class="">Extract department code from <code>stateOrProvinceCode</code> (split on <code>-</code>, take index <code>[1]</code>)</li>
<li class="">Call <code>get#ForzaMunicipality(departmentHeaderCode, countryId, city)</code> for both origin and destination</li>
<li class="">Retrieve <code>HeaderCodeTownship</code> for each city</li>
</ol><p><strong>Request payload (Base64-encoded, wrapped in <code>PayLoad</code>):</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Method&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&lt;endPoint.shipments.labels value&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Params&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;DateOfSale&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2026-02-20&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ContentDescription&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;from_address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;address1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;headerCodeTownship&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;city&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;to_address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;address1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;headerCodeTownship&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;city&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Parcels&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">...</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Order_Number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12345&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Ticket_Number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;IdCountry&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;CountPieces&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;CodeOfReference&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;357506&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TotalWeight&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TotalValue&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Collected&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Currency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;COD&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;CashOnDelivery&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;AmmountCashOnDelivery&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;CashOnDeliveryCurrency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div><p><strong>Security</strong>: HMAC-SHA256 signature of the full request map using <code>ClientSecretKey</code>, sent as <code>LauValue</code> header. Payload is Base64-encoded using <code>ShippingAggregatorHelper.mapToBase64(requestMap)</code>.</p><p><strong>Response decoding:</strong> <code>ShippingAggregatorHelper.decodePayLoad(responseMap)</code> decodes the Base64 response.</p><hr><h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="c807-honduras-el-salvador">C807 (Honduras, El Salvador)<a href="#c807-honduras-el-salvador" class="hash-link" aria-label="Direct link to C807 (Honduras, El Salvador)" title="Direct link to C807 (Honduras, El Salvador)" translate="no">​</a></h4><p><strong>Authentication:</strong> Bearer token via <code>get#Token</code> (OAuth2 password or client_credentials flow, cached per <code>partyRelationshipId</code>).</p><p><strong>Department/Municipality resolution:</strong></p><ol>
<li class=""><code>get#C807MatchingDepartment(stateProvinceName)</code> → fuzzy-match against C807&#x27;s department list → <code>departmentId</code></li>
<li class=""><code>get#C807MatchingMunicipality(cityName, departmentId)</code> → <code>municipalityId</code></li>
</ol><p><strong>COD Logic:</strong></p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (cod == &quot;true&quot; &amp;&amp; paymentStatusId == &quot;PAYMENT_NOT_RECEIVED&quot; &amp;&amp; shipmentMethodTypeId != &quot;SHIP_TO_STORE&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tipo_servicio = &quot;CCE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    monto_cce = validShipmentTotal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tipo_servicio = &quot;SER&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>STS Logic Override</div><div class="admonitionContent_BuS1"><p><strong>STS (Ship-To-Store) Orders always get <code>&quot;SER&quot;</code> (non-COD) regardless of payment status.</strong></p></div></div><p><strong>Request payload:</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;recolecta_fecha&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2026-02-20 19:00&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;tipo_entrega&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;shipmentMethod&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;provisional&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sede&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;facilityIdentification (optional)&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;guias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;orden&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;orderName&gt;-&lt;orderDate&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;nombre&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;destAddress.toName&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;direccion&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;address1&gt;, &lt;address2&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;telefono&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;phoneNumber&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;correo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;emailAddress&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;departamento_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;municipio_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;tipo_servicio&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SER&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;detalle&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;peso&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;contenido&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Package Weight&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;unidad_medida&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LB&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div><p><strong>Artifact fetch:</strong> After label creation, <code>get#C807Artifacts(trackingIds)</code> is called to retrieve the label PDF/image.</p><hr><h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="terminalexpress-costa-rica">TerminalExpress (Costa Rica)<a href="#terminalexpress-costa-rica" class="hash-link" aria-label="Direct link to TerminalExpress (Costa Rica)" title="Direct link to TerminalExpress (Costa Rica)" translate="no">​</a></h4><p><strong>Authentication:</strong> HTTP Basic Auth (<code>username</code>, <code>password</code> from settings — per request, no token caching).</p><p><strong>Required fields in <code>destAddress</code>:</strong> <code>phoneNumber</code>, <code>province</code>, <code>canton</code>, <code>district</code>, <code>toName</code><br>
<strong>Required in <code>originAddress</code>:</strong> <code>warehouseId</code></p><p><strong>Request payload:</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;PROVINCIA&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;destAddress.province&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;CANTON&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;destAddress.canton&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;DISTRITO&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;destAddress.district&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;PESO&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;CLIENTE_ID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1506&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;BODEGA_ID&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;originAddress.warehouseId&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;NOM_CLIENTE_FINAL&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;destAddress.toName&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;TEL_CLIENTE_FINAL&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;destAddress.phoneNumber&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;DIR_CLIENTE_FINAL&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;full address string&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;LOGISTICA_INVERSA&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;N&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div><p><strong>Endpoint:</strong> <code>POST {endPoint}{endPoint.shipments.labels}</code> → <code>https://sandboxlte.laterminalexpress.com/api/Paquetes/crearOrden/</code></p><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-rate-shopping--full-lifecycle">8. Rate Shopping — Full Lifecycle<a href="#8-rate-shopping--full-lifecycle" class="hash-link" aria-label="Direct link to 8. Rate Shopping — Full Lifecycle" title="Direct link to 8. Rate Shopping — Full Lifecycle" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="entry-point-1">Entry Point<a href="#entry-point-1" class="hash-link" aria-label="Direct link to Entry Point" title="Direct link to Entry Point" translate="no">​</a></h3><p><code>POST /rest/s1/shipping/shippingRate</code></p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-input-fields-1">Required Input Fields<a href="#required-input-fields-1" class="hash-link" aria-label="Direct link to Required Input Fields" title="Direct link to Required Input Fields" translate="no">​</a></h3><p>Same address fields as label generation, plus:</p><ul>
<li class=""><code>parcels</code> (with weight/dimensions)</li>
<li class=""><code>weightAmount</code></li>
<li class=""><code>currencyUomId</code></li>
</ul><p>Optional:</p><ul>
<li class=""><code>shipmentMethod</code>, <code>packagingType</code>, <code>pickupType</code>, <code>locationId</code>, <code>includeAlternativeRates</code></li>
</ul><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow">Flow<a href="#flow" class="hash-link" aria-label="Direct link to Flow" title="Direct link to Flow" translate="no">​</a></h3><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="notes-on-rate-shopping">Notes on Rate Shopping<a href="#notes-on-rate-shopping" class="hash-link" aria-label="Direct link to Notes on Rate Shopping" title="Direct link to Notes on Rate Shopping" translate="no">​</a></h3><ul>
<li class=""><strong>No rate aggregation across carriers</strong> — each REST call targets a single carrier (determined by user&#x27;s <code>PartyRelationship</code>)</li>
<li class=""><strong>Rate selection logic</strong> is handled by OFBiz, not Moqui — Moqui returns available rates; OFBiz selects</li>
<li class=""><strong>Forza rate endpoint</strong> uses same HMAC/Base64 pattern as labels</li>
<li class="">Rate caching is <strong>not implemented</strong> in the current codebase — each call hits the carrier API live</li>
</ul><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="9-label-voiding-refund--full-lifecycle">9. Label Voiding (Refund) — Full Lifecycle<a href="#9-label-voiding-refund--full-lifecycle" class="hash-link" aria-label="Direct link to 9. Label Voiding (Refund) — Full Lifecycle" title="Direct link to 9. Label Voiding (Refund) — Full Lifecycle" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="entry-point-2">Entry Point<a href="#entry-point-2" class="hash-link" aria-label="Direct link to Entry Point" title="Direct link to Entry Point" translate="no">​</a></h3><p><code>POST /rest/s1/shipping/refundShippingLabel</code></p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-input-fields-2">Required Input Fields<a href="#required-input-fields-2" class="hash-link" aria-label="Direct link to Required Input Fields" title="Direct link to Required Input Fields" translate="no">​</a></h3><table><thead><tr><th>Field</th><th>Required</th><th>Notes</th></tr></thead><tbody><tr><td><code>trackingNumber</code></td><td>Yes (validated)</td><td>The label tracking number to void</td></tr><tr><td><code>trackingIds</code></td><td>Optional (List)</td><td>For batch void</td></tr><tr><td><code>carrierPartyId</code></td><td>Optional</td><td>If not provided, uses <code>DefaultCarrier</code></td></tr></tbody></table><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flow-1">Flow<a href="#flow-1" class="hash-link" aria-label="Direct link to Flow" title="Direct link to Flow" translate="no">​</a></h3><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OFBiz → POST /refundShippingLabel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → get#ShippingGatewayDetails (resolve carrier)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → validate#RequiredParameters([&#x27;trackingNumber&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → find ShippingGatewayConfig (refundLabelsServiceName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → dynamic call to refundLabelsServiceName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.g. ForzaServices.refund#ForzaShippingLabel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.g. C807Services.refund#C807ShippingLabel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → GenericHandlerServices.handle#VoidShippingLabel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (looks up option: service.name.handle.void.label)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  → return responseMap to OFBiz</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="per-carrier-void-notes">Per-Carrier Void Notes<a href="#per-carrier-void-notes" class="hash-link" aria-label="Direct link to Per-Carrier Void Notes" title="Direct link to Per-Carrier Void Notes" translate="no">​</a></h3><p><strong>Forza (<code>refundShippingLabel.groovy</code>):</strong></p><ul>
<li class="">Validates <code>shippingGatewayConfigId</code>, <code>partyRelationshipId</code>, <code>trackingNumber</code></li>
<li class="">Uses same HMAC-SHA256 authentication</li>
<li class="">Calls <code>endPoint.shipments.void</code> endpoint</li>
<li class="">Response decoded with <code>decodePayLoad</code></li>
</ul><p><strong>C807 (<code>refundShippingLabel.groovy</code>):</strong></p><ul>
<li class="">Validates <code>trackingNumber</code> and optional <code>trackingIds</code></li>
<li class="">Gets Bearer token via <code>get#Token</code></li>
<li class="">Calls C807&#x27;s label cancellation endpoint</li>
<li class="">Handler normalizes response via <code>handle#C807VoidLabelResponseHandler</code></li>
</ul><p><strong>Void eligibility:</strong> Determined entirely by the carrier API — there is no time-window check in the Moqui layer. If the carrier returns an error (e.g., &quot;label already shipped&quot;), the error is propagated in <code>errorMessages</code>.</p><p><strong>Idempotency:</strong> Not explicitly implemented — a second void call with the same tracking number is forwarded to the carrier API again. The carrier API is expected to handle duplicate void requests gracefully (typically by returning a success or &quot;already voided&quot; message).</p><p><strong>Financial adjustments:</strong> Not handled by Moqui. OFBiz is responsible for any refund or financial reversal once it receives a successful void response.</p><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="10-webhook--order-status-callback">10. Webhook / Order Status Callback<a href="#10-webhook--order-status-callback" class="hash-link" aria-label="Direct link to 10. Webhook / Order Status Callback" title="Direct link to 10. Webhook / Order Status Callback" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="inbound-flow-carrier--moqui--ofbiz">Inbound Flow (Carrier → Moqui → OFBiz)<a href="#inbound-flow-carrier--moqui--ofbiz" class="hash-link" aria-label="Direct link to Inbound Flow (Carrier → Moqui → OFBiz)" title="Direct link to Inbound Flow (Carrier → Moqui → OFBiz)" translate="no">​</a></h3><p><code>POST /rest/s1/shipping/orderStatus</code></p><p>This endpoint accepts delivery status updates pushed by carriers (e.g., C807 webhooks).</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Carrier ──POST──► Moqui /orderStatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ├── Read headers: Partyid, Carrierid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ├── Find PartyRelationship (validates client, carrier)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ├── Load settings: ShippingGatewayConfigId, ClientUrl, ClientOrderEndpoint, ClientAuthKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ├── Look up option: service.name.handle.webhook.response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ├── Call handler service (parses carrier-specific webhook payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │     e.g. C807Services.handle#C807WebhookResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │     → returns normalized responseMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    └── POST normalized responseMap to OFBiz:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          URL = settingsMap.ClientUrl + settingsMap.ClientOrderEndpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          Header: Authorization: Basic &lt;ClientAuthKey&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          Body: JSON responseMap</span><br></span></code></pre></div></div><p><strong>Key data flow:</strong></p><ul>
<li class=""><code>Partyid</code> header → identifies the tenant (e.g., <code>ADOC_SV</code>)</li>
<li class=""><code>Carrierid</code> header → identifies the carrier (e.g., <code>C807</code>)</li>
<li class="">The webhook body is read raw via <code>ec.web.getRequestBodyText()</code></li>
<li class="">The response is forwarded to OFBiz at: <code>ClientUrl + ClientOrderEndpoint</code>
<ul>
<li class="">For ADOC_SV: <code>https://adoc-sv-uat.hotwax.io/api/service/orderDeliveryStatus</code></li>
<li class="">For ADOC_HN: <code>https://adoc-hn-uat.hotwax.io/api/service/orderDeliveryStatus</code></li>
</ul>
</li>
</ul><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-carrier-integration-details">11. Carrier Integration Details<a href="#11-carrier-integration-details" class="hash-link" aria-label="Direct link to 11. Carrier Integration Details" title="Direct link to 11. Carrier Integration Details" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="carrier-inventory">Carrier Inventory<a href="#carrier-inventory" class="hash-link" aria-label="Direct link to Carrier Inventory" title="Direct link to Carrier Inventory" translate="no">​</a></h3><table><thead><tr><th>Carrier ID</th><th>Display Name</th><th>Country</th><th>Auth</th><th>Rate</th><th>Label</th><th>Void</th><th>Manifest</th></tr></thead><tbody><tr><td><code>FORZA</code></td><td>Forza</td><td>GT</td><td>HMAC+Base64</td><td>✅</td><td>✅</td><td>✅</td><td>❓</td></tr><tr><td><code>C807</code></td><td>C807</td><td>HN, SV</td><td>OAuth2 Bearer</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td><code>TERMINAL_EXPRESS</code></td><td>Terminal Express</td><td>CR</td><td>Basic Auth</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td><code>MOOVIN</code></td><td>Moovin</td><td>GT</td><td>Basic/OAuth2</td><td>❓</td><td>✅</td><td>❓</td><td>❓</td></tr><tr><td><code>DRIVIN</code></td><td>Drivin</td><td>GT, SV</td><td>Static Bearer</td><td>❓</td><td>✅</td><td>❓</td><td>❓</td></tr><tr><td><code>CARGOTRANS</code></td><td>CargoTrans</td><td>GT</td><td>OAuth2</td><td>❓</td><td>✅</td><td>❓</td><td>❓</td></tr><tr><td><code>CITI_EXPRESS</code></td><td>CitiExpress</td><td>-</td><td>API Key</td><td>❓</td><td>✅</td><td>❓</td><td>❓</td></tr></tbody></table><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shippinggatewayconfig-per-carrier">ShippingGatewayConfig per Carrier<a href="#shippinggatewayconfig-per-carrier" class="hash-link" aria-label="Direct link to ShippingGatewayConfig per Carrier" title="Direct link to ShippingGatewayConfig per Carrier" translate="no">​</a></h3><p><strong>Forza:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;FORZA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getRateServiceName = &quot;co.hotwax.shippingAggregator.forza.ForzaServices.get#ForzaShippingRate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requestLabelsServiceName = &quot;co.hotwax.shippingAggregator.forza.ForzaServices.request#ForzaShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refundLabelsServiceName = &quot;co.hotwax.shippingAggregator.forza.ForzaServices.refund#ForzaShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;Forza API base URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.accessToken = &lt;token endpoint path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.labels = &lt;label path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.void = &lt;void path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipment.rate = &lt;rate path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.label = ForzaServices.handle#ForzaLabelResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.rate = ForzaServices.handle#ForzaRateResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.void.label = ForzaServices.handle#ForzaVoidLabelResponseHandler</span><br></span></code></pre></div></div><p><strong>C807:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;C807&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requestLabelsServiceName = &quot;co.hotwax.shippingAggregator.c807.C807Services.request#C807ShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refundLabelsServiceName = &quot;co.hotwax.shippingAggregator.c807.C807Services.refund#C807ShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;C807 API base URL&gt;  (settingsMap.EndPoint per-relationship, OR optionsMap.endPoint)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.accessToken = &lt;token path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.labels = &lt;label path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.void = &lt;void path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.artifacts = &lt;artifact/pdf path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.label = C807Services.handle#C807LabelResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.void.label = C807Services.handle#C807VoidLabelResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.webhook.response = C807Services.handle#C807WebhookResponseHandler</span><br></span></code></pre></div></div><p><strong>TerminalExpress:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;TERMINAL_EXPRESS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requestLabelsServiceName = &quot;co.hotwax.shippingAggregator.terminalExpress.TerminalExpressServices.request#TerminalExpressShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &quot;https://sandboxlte.laterminalexpress.com/api/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.labels = &quot;Paquetes/crearOrden/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.label = TerminalExpressServices.handle#TerminalExpressResponseHandler</span><br></span></code></pre></div></div><p><strong>Moovin:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;MOOVIN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postOrderServiceName = &quot;co.hotwax.shippingAggregator.moovin.MoovinServices.post#MoovinOrder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deleteOrderServiceName = &quot;co.hotwax.shippingAggregator.moovin.MoovinServices.delete#MoovinOrder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;Moovin API base URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.post.order = &lt;post order path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.post.order = MoovinServices.handle#MoovinHandlePostOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.delete.order = MoovinServices.handle#MoovinHandleDeleteOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.rate = MoovinServices.handle#MoovinHandleRateResponse</span><br></span></code></pre></div></div><p><em>Note: Moovin uses the <code>postOrder</code>/<code>deleteOrder</code> paradigm instead of <code>requestShippingLabel</code>.</em></p><p><strong>Drivin:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;DRIVIN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postOrderServiceName = &quot;co.hotwax.shippingAggregator.drivIn.DrivInServices.post#DrivInpostOrder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deleteOrderServiceName = &quot;co.hotwax.shippingAggregator.drivIn.DrivInServices.delete#DrivInDeleteOrder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;Drivin API base URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.post.order = &lt;post order path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.post.order = DrivInServices.handle#DrivInHandlePostOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.delete.order = DrivInServices.handle#DrivInHandleDeleteOrder</span><br></span></code></pre></div></div><p><em>Note: Uses an <code>ApiToken</code> via the <code>X-API-Key</code> header and dynamically queries for a <code>schema_code</code> on post order.</em></p><p><strong>CargoTrans:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;CARGOTRANS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getRateServiceName = &quot;co.hotwax.shippingAggregator.cargoTrans.CargoTransServices.get#CargoTransShippingRate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requestLabelsServiceName = &quot;co.hotwax.shippingAggregator.cargoTrans.CargoTransServices.request#CargoTransShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;CargoTrans API base URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.labels = &lt;label creation path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  businessCategory.default = &lt;category ID&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.label = CargoTransServices.handle#CargoTransLabelResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.rate = CargoTransServices.handle#CargoTransRateResponseHandler</span><br></span></code></pre></div></div><p><em>Note: Requires a <code>ClientId</code> parameter in the payload body and a <code>ClientSecretKey</code> for the <code>X-API-Key</code> auth header. Also queries for a <code>municipalityId</code>.</em></p><p><strong>CitiExpress:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;CITI_EXPRESS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postOrderServiceName = &quot;co.hotwax.shippingAggregator.citiExpress.CitiExpressServices.post#CitiExpressOrder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deleteOrderServiceName = &quot;co.hotwax.shippingAggregator.citiExpress.CitiExpressServices.delete#CitiExpressOrder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;CitiExpress API base URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.post.order = &lt;post order path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.post.order = CitiExpressServices.handle#CitiExpressHandlePostOrder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.delete.order = CitiExpressServices.handle#CitiExpressHandleDeleteOrder</span><br></span></code></pre></div></div><p><em>Note: Passes the <code>ApiKey</code> setting directly inside the JSON payload logic. Requires precise coordinate attributes (<code>job_pickup_latitude</code> / <code>longitude</code>).</em></p><p><strong>FedEx:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shippingGatewayConfigId = &quot;FEDEX&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getRateServiceName = &quot;co.hotwax.shippingAggregator.Fedex.FedexServices.get#FedexShippingRate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requestLabelsServiceName = &quot;co.hotwax.shippingAggregator.Fedex.FedexServices.request#FedexShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refundLabelsServiceName = &quot;co.hotwax.shippingAggregator.Fedex.FedexServices.refund#FedexShippingLabel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint = &lt;FedEx API base URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.accessToken = &lt;token path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipments.labels = &lt;label path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endPoint.shipment.rate = &lt;rate path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.label = FedexServices.handle#FedexLabelResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.get.rate = FedexServices.handle#FedexRateResponseHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service.name.handle.void.label = FedexServices.handle#FedexVoidLabelResponseHandler</span><br></span></code></pre></div></div><p><em>Note: Implements standard OAuth2 (<code>client_credentials</code>) and caches the <code>accessToken</code>. Distinct from others, deeply standardized shipping fields (e.g. <code>LabelStockType</code>, dimensional units).</em></p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adoc-client--carrier-relationships">ADOC Client → Carrier Relationships<a href="#adoc-client--carrier-relationships" class="hash-link" aria-label="Direct link to ADOC Client → Carrier Relationships" title="Direct link to ADOC Client → Carrier Relationships" translate="no">​</a></h3><table><thead><tr><th>Relationship ID</th><th>Client</th><th>Carrier</th><th>Auth Setting</th></tr></thead><tbody><tr><td><code>ADOC_FORZA</code></td><td><code>ADOC</code></td><td><code>FORZA</code></td><td><code>ClientId=53489</code>, <code>ClientSecretKey=...</code>, <code>CodApp=...</code>, <code>AccountNumber=...</code></td></tr><tr><td><code>ADOC_MOOVIN</code></td><td><code>ADOC</code></td><td><code>MOOVIN</code></td><td><code>Username=ADOC</code>, <code>Password=...</code></td></tr><tr><td><code>ADOC_CARGO</code></td><td><code>ADOC</code></td><td><code>CARGOTRANS</code></td><td><code>ClientId=2587</code>, <code>ClientSecretKey=...</code></td></tr><tr><td><code>ADOC_TERMINAL_EXPRESS</code></td><td><code>ADOC</code></td><td><code>TERMINAL_EXPRESS</code></td><td><code>ClientId=1506</code>, <code>Username</code>, <code>Password</code>, <code>ReverseLogistics=N</code></td></tr><tr><td><code>ADOC_CITI_EXPRESS</code></td><td><code>ADOC</code></td><td><code>CITI_EXPRESS</code></td><td><code>ApiKey=...</code></td></tr><tr><td><code>ADOC_DRIVIN</code></td><td><code>ADOC</code></td><td><code>DRIVIN</code></td><td><code>ApiToken=...</code></td></tr><tr><td><code>ADOC_C807</code></td><td><code>ADOC</code></td><td><code>C807</code></td><td><code>Username</code>, <code>Password</code>, <code>EndPoint=https://app.c807.com/</code>, <code>AuthType=BASIC_AUTH</code></td></tr><tr><td><code>ADOC_SV_C807</code></td><td><code>ADOC_SV</code></td><td><code>C807</code></td><td>same + <code>ClientUrl</code>, <code>ClientOrderEndpoint</code>, <code>ClientAuthKey</code></td></tr><tr><td><code>ADOC_SV_DRIVIN</code></td><td><code>ADOC_SV</code></td><td><code>DRIVIN</code></td><td><code>ApiToken=...</code></td></tr><tr><td><code>ADOC_HN_C807</code></td><td><code>ADOC_HN</code></td><td><code>C807</code></td><td><code>EndPoint=https://devapp.c807.com/</code>, <code>ClientUrl=https://adoc-hn-uat.hotwax.io</code></td></tr></tbody></table><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-error-handling--logging">12. Error Handling &amp; Logging<a href="#12-error-handling--logging" class="hash-link" aria-label="Direct link to 12. Error Handling &amp; Logging" title="Direct link to 12. Error Handling &amp; Logging" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="validation-layer">Validation Layer<a href="#validation-layer" class="hash-link" aria-label="Direct link to Validation Layer" title="Direct link to Validation Layer" translate="no">​</a></h3><p><code>HelperServices.validate#RequiredParameters</code> (backed by <code>validateRequiredParameters.groovy</code>):</p><ul>
<li class="">Accepts a list of required field names and a parameters map</li>
<li class="">Returns <code>{success: true}</code> or <code>{success: false, errorMessage: &quot;Missing: field1, field2&quot;}</code></li>
<li class="">Called at the generic level (address required) and at the carrier level (carrier-specific fields)</li>
</ul><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-propagation-pattern">Error Propagation Pattern<a href="#error-propagation-pattern" class="hash-link" aria-label="Direct link to Error Propagation Pattern" title="Direct link to Error Propagation Pattern" translate="no">​</a></h3><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Carrier service returns: { success: false, errorMessages: [...] }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   → parent service returns: { success: false, errorMessages: [...] }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   → GenericShippingServices returns: responseMap with success=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   → OFBiz receives JSON: { &quot;success&quot;: false, &quot;errorMessages&quot;: &quot;...&quot; }</span><br></span></code></pre></div></div><p><strong>Forza-specific:</strong> Wraps restClient.call() in try/catch:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ec.logger.error(&quot;DIAGNOSTIC: Error calling Forza Label API: ${e.getMessage()}&quot;, e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorMessages.add(&quot;Unable to make request to Forza. Error: ${e.getMessage()}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return [success: false, errorMessages: errorMessages]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="logging-conventions">Logging Conventions<a href="#logging-conventions" class="hash-link" aria-label="Direct link to Logging Conventions" title="Direct link to Logging Conventions" translate="no">​</a></h3><table><thead><tr><th>Log Level</th><th>When Used</th></tr></thead><tbody><tr><td><code>warn</code></td><td>Diagnostic logs (currently active in most carrier files)</td></tr><tr><td><code>warn</code></td><td>HTTP non-2xx response codes</td></tr><tr><td><code>info</code></td><td>Service call tracking (&quot;Calling service ...&quot;, &quot;Response returned for ...&quot;)</td></tr><tr><td><code>error</code></td><td>Exceptions caught in try/catch</td></tr></tbody></table><p><strong>Diagnostic logging</strong> (added during debugging, currently active):</p><ul>
<li class=""><code>DIAGNOSTIC: Terminal Express start for configId: ...</code></li>
<li class=""><code>DIAGNOSTIC: C807 Request Body: ...</code></li>
<li class=""><code>DIAGNOSTIC: Forza Label Response Code: ...</code></li>
</ul><blockquote>
<p>⚠️ These WARN-level diagnostic logs are verbose. They should be removed or changed to DEBUG before production.</p>
</blockquote><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="http-status-handling">HTTP Status Handling<a href="#http-status-handling" class="hash-link" aria-label="Direct link to HTTP Status Handling" title="Direct link to HTTP Status Handling" translate="no">​</a></h3><p>All carrier services follow this pattern:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (restResponse.statusCode &lt; 200 || restResponse.statusCode &gt;= 300) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ec.logger.warn(&quot;Unsuccessful with status code: ${restResponse.statusCode} and response: ${restResponse.text()}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// response is still parsed — carrier may include error details in 4xx body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map responseMap = restResponse.jsonObject()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return responseMap</span><br></span></code></pre></div></div><p>The carrier service does <strong>not throw exceptions</strong> for HTTP errors — it returns the parsed JSON body (which may contain carrier-specific error fields). The handler and OFBiz are responsible for interpreting these.</p><hr><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="13-configuration-reference">13. Configuration Reference<a href="#13-configuration-reference" class="hash-link" aria-label="Direct link to 13. Configuration Reference" title="Direct link to 13. Configuration Reference" translate="no">​</a></h2><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-add-a-new-carrier">How to Add a New Carrier<a href="#how-to-add-a-new-carrier" class="hash-link" aria-label="Direct link to How to Add a New Carrier" title="Direct link to How to Add a New Carrier" translate="no">​</a></h3><ol>
<li class="">
<p><strong>Create Party:</strong> Add <code>mantle.party.Party</code> with <code>partyTypeEnumId=&quot;PtyOrganization&quot;</code> and <code>roleTypeId=&quot;Carrier&quot;</code></p>
</li>
<li class="">
<p><strong>Create ShippingGatewayConfig:</strong></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ShippingGatewayConfig</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">shippingGatewayConfigId</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">NEW_CARRIER</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">shippingGatewayTypeEnumId</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ShGtwyTrdPrty</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">requestLabelsServiceName</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">co.hotwax.shippingAggregator.newcarrier.NewCarrierServices.request#NewCarrierLabel</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Add ShippingGatewayOptions:</strong> Endpoints + handler service names</p>
</li>
<li class="">
<p><strong>Create PartyRelationship:</strong> Link client party (e.g., <code>ADOC</code>) to the new carrier</p>
</li>
<li class="">
<p><strong>Add PartyRelationshipSettings:</strong> Credentials + <code>ShippingGatewayConfigId</code></p>
</li>
<li class="">
<p><strong>Implement Groovy service:</strong> Create <code>service/co/hotwax/shippingAggregator/newcarrier/</code> with label/rate/refund groovy scripts</p>
</li>
<li class="">
<p><strong>Register in XML:</strong> Create <code>NewCarrierServices.xml</code> wrapping the groovy scripts</p>
</li>
</ol><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="endpoint-url-resolution-priority-order">Endpoint URL Resolution (Priority Order)<a href="#endpoint-url-resolution-priority-order" class="hash-link" aria-label="Direct link to Endpoint URL Resolution (Priority Order)" title="Direct link to Endpoint URL Resolution (Priority Order)" translate="no">​</a></h3><p>For most carriers, the base URL is determined as follows:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def baseUrl = settingsMap.containsKey(&quot;EndPoint&quot;) ? settingsMap.EndPoint : optionsMap.endPoint</span><br></span></code></pre></div></div><p><code>settingsMap.EndPoint</code> (from <code>PartyRelationshipSetting</code>) <strong>overrides</strong> <code>optionsMap.endPoint</code> (from <code>ShippingGatewayOption</code>). This allows per-relationship URL customization without changing the gateway config (e.g., production vs. dev endpoints for different ADOC instances).</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-service-dependencies">Key Service Dependencies<a href="#key-service-dependencies" class="hash-link" aria-label="Direct link to Key Service Dependencies" title="Direct link to Key Service Dependencies" translate="no">​</a></h3><table><thead><tr><th>Utility Class</th><th>Location</th><th>Purpose</th></tr></thead><tbody><tr><td><code>co.hotwax.helper.ShippingAggregatorHelper</code></td><td><code>src/</code> directory</td><td><code>getShippingGatewayConfigOptions()</code>, <code>getPartyRelationshipSettings()</code>, <code>getFieldsMapFromList()</code>, <code>mapToBase64()</code>, <code>decodePayLoad()</code></td></tr><tr><td><code>co.hotwax.helper.LauValueGenerator</code></td><td><code>src/</code> directory</td><td>HMAC-SHA256 signature generation for Forza</td></tr><tr><td><code>org.moqui.util.RestClient</code></td><td>Moqui framework</td><td>HTTP client for all carrier API calls</td></tr></tbody></table></div></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#1-system-overview" class="table-of-contents__link toc-highlight">1. System Overview</a><ul><li><a href="#key-design-decisions" class="table-of-contents__link toc-highlight">Key Design Decisions</a></li></ul></li><li><a href="#2-moqui--ofbiz-integration-boundary" class="table-of-contents__link toc-highlight">2. Moqui ↔ OFBiz Integration Boundary</a><ul><li><a href="#how-ofbiz-calls-moqui" class="table-of-contents__link toc-highlight">How OFBiz Calls Moqui</a></li><li><a href="#data-ofbiz-sends-to-moqui" class="table-of-contents__link toc-highlight">Data OFBiz Sends to Moqui</a></li><li><a href="#data-moqui-returns-to-ofbiz" class="table-of-contents__link toc-highlight">Data Moqui Returns to OFBiz</a></li></ul></li><li><a href="#3-core-architecture-the-plugin-pattern" class="table-of-contents__link toc-highlight">3. Core Architecture: The Plugin Pattern</a><ul><li><a href="#step-1--getshippinggatewaydetails" class="table-of-contents__link toc-highlight">Step 1 — <code>get#ShippingGatewayDetails</code></a></li><li><a href="#step-3--service-name-resolution-via-shippinggatewayconfig" class="table-of-contents__link toc-highlight">Step 3 — Service Name Resolution via ShippingGatewayConfig</a></li><li><a href="#step-4--dynamic-dispatch" class="table-of-contents__link toc-highlight">Step 4 — Dynamic Dispatch</a></li><li><a href="#step-5--handler-normalization" class="table-of-contents__link toc-highlight">Step 5 — Handler Normalization</a></li></ul></li><li><a href="#4-entity-model--configuration-data" class="table-of-contents__link toc-highlight">4. Entity Model &amp; Configuration Data</a><ul><li><a href="#core-mantle-entities-used" class="table-of-contents__link toc-highlight">Core Mantle Entities Used</a></li><li><a href="#partysettingtype-values" class="table-of-contents__link toc-highlight"><code>PartySettingType</code> Values</a></li><li><a href="#shippinggatewayoption-optionenumid-values" class="table-of-contents__link toc-highlight"><code>ShippingGatewayOption</code> <code>optionEnumId</code> Values</a></li></ul></li><li><a href="#5-rest-api-surface" class="table-of-contents__link toc-highlight">5. REST API Surface</a></li><li><a href="#6-authentication--token-management" class="table-of-contents__link toc-highlight">6. Authentication &amp; Token Management</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#gettoken-flow" class="table-of-contents__link toc-highlight"><code>get#Token</code> Flow</a></li><li><a href="#carrier-auth-patterns" class="table-of-contents__link toc-highlight">Carrier Auth Patterns</a></li></ul></li><li><a href="#7-label-generation--full-lifecycle" class="table-of-contents__link toc-highlight">7. Label Generation — Full Lifecycle</a><ul><li><a href="#entry-point" class="table-of-contents__link toc-highlight">Entry Point</a></li><li><a href="#required-input-fields" class="table-of-contents__link toc-highlight">Required Input Fields</a></li><li><a href="#complete-call-sequence" class="table-of-contents__link toc-highlight">Complete Call Sequence</a></li><li><a href="#interactive-payload-simulator" class="table-of-contents__link toc-highlight">Interactive Payload Simulator</a></li><li><a href="#per-carrier-label-request-construction" class="table-of-contents__link toc-highlight">Per-Carrier Label Request Construction</a></li></ul></li><li><a href="#8-rate-shopping--full-lifecycle" class="table-of-contents__link toc-highlight">8. Rate Shopping — Full Lifecycle</a><ul><li><a href="#entry-point-1" class="table-of-contents__link toc-highlight">Entry Point</a></li><li><a href="#required-input-fields-1" class="table-of-contents__link toc-highlight">Required Input Fields</a></li><li><a href="#flow" class="table-of-contents__link toc-highlight">Flow</a></li><li><a href="#notes-on-rate-shopping" class="table-of-contents__link toc-highlight">Notes on Rate Shopping</a></li></ul></li><li><a href="#9-label-voiding-refund--full-lifecycle" class="table-of-contents__link toc-highlight">9. Label Voiding (Refund) — Full Lifecycle</a><ul><li><a href="#entry-point-2" class="table-of-contents__link toc-highlight">Entry Point</a></li><li><a href="#required-input-fields-2" class="table-of-contents__link toc-highlight">Required Input Fields</a></li><li><a href="#flow-1" class="table-of-contents__link toc-highlight">Flow</a></li><li><a href="#per-carrier-void-notes" class="table-of-contents__link toc-highlight">Per-Carrier Void Notes</a></li></ul></li><li><a href="#10-webhook--order-status-callback" class="table-of-contents__link toc-highlight">10. Webhook / Order Status Callback</a><ul><li><a href="#inbound-flow-carrier--moqui--ofbiz" class="table-of-contents__link toc-highlight">Inbound Flow (Carrier → Moqui → OFBiz)</a></li></ul></li><li><a href="#11-carrier-integration-details" class="table-of-contents__link toc-highlight">11. Carrier Integration Details</a><ul><li><a href="#carrier-inventory" class="table-of-contents__link toc-highlight">Carrier Inventory</a></li><li><a href="#shippinggatewayconfig-per-carrier" class="table-of-contents__link toc-highlight">ShippingGatewayConfig per Carrier</a></li><li><a href="#adoc-client--carrier-relationships" class="table-of-contents__link toc-highlight">ADOC Client → Carrier Relationships</a></li></ul></li><li><a href="#12-error-handling--logging" class="table-of-contents__link toc-highlight">12. Error Handling &amp; Logging</a><ul><li><a href="#validation-layer" class="table-of-contents__link toc-highlight">Validation Layer</a></li><li><a href="#error-propagation-pattern" class="table-of-contents__link toc-highlight">Error Propagation Pattern</a></li><li><a href="#logging-conventions" class="table-of-contents__link toc-highlight">Logging Conventions</a></li><li><a href="#http-status-handling" class="table-of-contents__link toc-highlight">HTTP Status Handling</a></li></ul></li><li><a href="#13-configuration-reference" class="table-of-contents__link toc-highlight">13. Configuration Reference</a><ul><li><a href="#how-to-add-a-new-carrier" class="table-of-contents__link toc-highlight">How to Add a New Carrier</a></li><li><a href="#endpoint-url-resolution-priority-order" class="table-of-contents__link toc-highlight">Endpoint URL Resolution (Priority Order)</a></li><li><a href="#key-service-dependencies" class="table-of-contents__link toc-highlight">Key Service Dependencies</a></li></ul></li></ul></div></div></div></main></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Dynamic-Docs/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Dynamic-Docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[9486],{4071(e,r,i){i.r(r),i.d(r,{assets:()=>u,contentTitle:()=>p,default:()=>v,frontMatter:()=>j,metadata:()=>n,toc:()=>g});const n=JSON.parse('{"type":"mdx","permalink":"/Dynamic-Docs/ARCHITECTURE","source":"@site/src/pages/ARCHITECTURE.md","title":"Shipping Aggregator \u2014 Complete Architecture & Functional Reference","description":"This architectural document includes interactive components like the Carrier Payload Simulator and tabbed code blocks to help you understand the integration boundary.","frontMatter":{},"unlisted":false}');var s=i(4848),d=i(8453),t=i(1470),c=i(9365),l=(i(7293),i(4923)),a=i(6540),o=i(8149);const h={FORZA:{label:"FORZA (Guatemala)",auth:"HMAC-SHA256 signature (LauValue header) + Base64 payload encoding",description:"Requires State/Province code extraction and custom Municipality/Township resolution. Returns an order number that must be digits only.",template:()=>({Method:"/Paquetes/Crear",Params:{DateOfSale:(new Date).toISOString().split("T")[0],ContentDescription:"Apparel Order",from_address:{name:"Warehouse GT",phone:"0000-0000",email:"warehouse@adoc.com",address1:"Zona 1, Ciudad",headerCodeTownship:"10101",city:"Guatemala"},to_address:{name:"Juan Perez",phone:"1111-2222",email:"juan@example.com",address1:"Calle Principal",headerCodeTownship:"10101",city:"Guatemala"},Parcels:[{Weight:2.5,Length:10,Width:10,Height:5}],Order_Number:"2024001",IdCountry:"GT",CountPieces:1,CodeOfReference:"357506",TotalWeight:2.5,TotalValue:150,Currency:"USD"}})},C807:{label:"C807 (Honduras, El Salvador)",auth:"OAuth2 Bearer token (cached per partyRelationshipId)",description:'Focuses on departments and municipalities IDs. Implements specific COD (Cash On Delivery) logic where STS orders always get "SER".',template:()=>({recolecta_fecha:`${(new Date).toISOString().split("T")[0]} 19:00`,tipo_entrega:"STANDARD",provisional:!1,sede:"FAC_HN_01",guias:[{orden:`ORD-${Date.now()}`,nombre:"Maria Garcia",direccion:"Barrio El Centro, Casa 12",telefono:"9999-8888",correo:"maria@example.com",departamento_id:5,municipio_id:23,tipo_servicio:"SER",detalle:[{peso:2.5,contenido:"Zapatos",unidad_medida:"LB"}]}]})},TERMINAL_EXPRESS:{label:"Terminal Express (Costa Rica)",auth:"HTTP Basic Auth (username:password per request)",description:"Requires specific location hierarchy (Province, Canton, District) and Carrier Warehouse ID.",template:()=>({PROVINCIA:"San Jos\xe9",CANTON:"San Jos\xe9",DISTRITO:"Carmen",PESO:2.5,CLIENTE_ID:"1506",BODEGA_ID:"WH_CR_MAIN",NOM_CLIENTE_FINAL:"Carlos Ruiz",TEL_CLIENTE_FINAL:"8888-7777",DIR_CLIENTE_FINAL:"Avenida Central, San Jose",LOGISTICA_INVERSA:"N"})}};function x(){const[e,r]=(0,a.useState)("FORZA"),i=h[e],n=JSON.stringify(i.template(),null,2);return(0,s.jsxs)("div",{style:{border:"1px solid var(--ifm-color-emphasis-200)",borderRadius:"8px",padding:"16px",marginBottom:"16px"},children:[(0,s.jsx)("h3",{children:"Label Payload Simulator"}),(0,s.jsx)("p",{children:"Select a carrier to view their required payload structure and authentication method."}),(0,s.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,s.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"Carrier Network:"}),(0,s.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:Object.keys(h).map(i=>(0,s.jsx)("button",{onClick:()=>r(i),className:"button "+(e===i?"button--primary":"button--secondary"),style:{padding:"8px 16px"},children:h[i].label},i))})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"16px",marginBottom:"16px"},children:[(0,s.jsxs)("div",{style:{padding:"12px",background:"var(--ifm-color-danger-contrast-background)",borderRadius:"4px",borderLeft:"4px solid var(--ifm-color-danger)"},children:[(0,s.jsx)("strong",{children:"Authentication:"})," ",i.auth]}),(0,s.jsxs)("div",{style:{padding:"12px",background:"var(--ifm-background-color)",borderRadius:"4px",borderLeft:"4px solid var(--ifm-color-primary)"},children:[(0,s.jsx)("strong",{children:"Key Differences:"})," ",i.description]})]}),(0,s.jsx)(o.A,{language:"json",title:`${i.label} Label Request Payload`,children:n})]})}const j={},p="Shipping Aggregator \u2014 Complete Architecture & Functional Reference",u={},g=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"1. System Overview",id:"1-system-overview",level:2},{value:"Key Design Decisions",id:"key-design-decisions",level:3},{value:"2. Moqui \u2194 OFBiz Integration Boundary",id:"2-moqui--ofbiz-integration-boundary",level:2},{value:"How OFBiz Calls Moqui",id:"how-ofbiz-calls-moqui",level:3},{value:"Data OFBiz Sends to Moqui",id:"data-ofbiz-sends-to-moqui",level:3},{value:"Data Moqui Returns to OFBiz",id:"data-moqui-returns-to-ofbiz",level:3},{value:"3. Core Architecture: The Plugin Pattern",id:"3-core-architecture-the-plugin-pattern",level:2},{value:"Step 1 \u2014 <code>get#ShippingGatewayDetails</code>",id:"step-1--getshippinggatewaydetails",level:3},{value:"Step 3 \u2014 Service Name Resolution via ShippingGatewayConfig",id:"step-3--service-name-resolution-via-shippinggatewayconfig",level:3},{value:"Step 4 \u2014 Dynamic Dispatch",id:"step-4--dynamic-dispatch",level:3},{value:"Step 5 \u2014 Handler Normalization",id:"step-5--handler-normalization",level:3},{value:"4. Entity Model &amp; Configuration Data",id:"4-entity-model--configuration-data",level:2},{value:"Core Mantle Entities Used",id:"core-mantle-entities-used",level:3},{value:"<code>PartySettingType</code> Values",id:"partysettingtype-values",level:3},{value:"<code>ShippingGatewayOption</code> <code>optionEnumId</code> Values",id:"shippinggatewayoption-optionenumid-values",level:3},{value:"5. REST API Surface",id:"5-rest-api-surface",level:2},{value:"6. Authentication &amp; Token Management",id:"6-authentication--token-management",level:2},{value:"Overview",id:"overview",level:3},{value:"<code>get#Token</code> Flow",id:"gettoken-flow",level:3},{value:"Carrier Auth Patterns",id:"carrier-auth-patterns",level:3},{value:"7. Label Generation \u2014 Full Lifecycle",id:"7-label-generation--full-lifecycle",level:2},{value:"Entry Point",id:"entry-point",level:3},{value:"Required Input Fields",id:"required-input-fields",level:3},{value:"Complete Call Sequence",id:"complete-call-sequence",level:3},{value:"Interactive Payload Simulator",id:"interactive-payload-simulator",level:3},{value:"Per-Carrier Label Request Construction",id:"per-carrier-label-request-construction",level:3},{value:"Forza (Guatemala)",id:"forza-guatemala",level:4},{value:"C807 (Honduras, El Salvador)",id:"c807-honduras-el-salvador",level:4},{value:"TerminalExpress (Costa Rica)",id:"terminalexpress-costa-rica",level:4},{value:"8. Rate Shopping \u2014 Full Lifecycle",id:"8-rate-shopping--full-lifecycle",level:2},{value:"Entry Point",id:"entry-point-1",level:3},{value:"Required Input Fields",id:"required-input-fields-1",level:3},{value:"Flow",id:"flow",level:3},{value:"Notes on Rate Shopping",id:"notes-on-rate-shopping",level:3},{value:"9. Label Voiding (Refund) \u2014 Full Lifecycle",id:"9-label-voiding-refund--full-lifecycle",level:2},{value:"Entry Point",id:"entry-point-2",level:3},{value:"Required Input Fields",id:"required-input-fields-2",level:3},{value:"Flow",id:"flow-1",level:3},{value:"Per-Carrier Void Notes",id:"per-carrier-void-notes",level:3},{value:"10. Webhook / Order Status Callback",id:"10-webhook--order-status-callback",level:2},{value:"Inbound Flow (Carrier \u2192 Moqui \u2192 OFBiz)",id:"inbound-flow-carrier--moqui--ofbiz",level:3},{value:"11. Carrier Integration Details",id:"11-carrier-integration-details",level:2},{value:"Carrier Inventory",id:"carrier-inventory",level:3},{value:"ShippingGatewayConfig per Carrier",id:"shippinggatewayconfig-per-carrier",level:3},{value:"ADOC Client \u2192 Carrier Relationships",id:"adoc-client--carrier-relationships",level:3},{value:"12. Error Handling &amp; Logging",id:"12-error-handling--logging",level:2},{value:"Validation Layer",id:"validation-layer",level:3},{value:"Error Propagation Pattern",id:"error-propagation-pattern",level:3},{value:"Logging Conventions",id:"logging-conventions",level:3},{value:"HTTP Status Handling",id:"http-status-handling",level:3},{value:"13. Configuration Reference",id:"13-configuration-reference",level:2},{value:"How to Add a New Carrier",id:"how-to-add-a-new-carrier",level:3},{value:"Endpoint URL Resolution (Priority Order)",id:"endpoint-url-resolution-priority-order",level:3},{value:"Key Service Dependencies",id:"key-service-dependencies",level:3}];function m(e){const r={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"shipping-aggregator--complete-architecture--functional-reference",children:"Shipping Aggregator \u2014 Complete Architecture & Functional Reference"})}),"\n",(0,s.jsx)(l.A,{}),"\n",(0,s.jsx)(r.admonition,{title:"Interactive Guide",type:"info",children:(0,s.jsx)(r.p,{children:"This architectural document includes interactive components like the Carrier Payload Simulator and tabbed code blocks to help you understand the integration boundary."})}),"\n",(0,s.jsxs)("div",{id:"printable-content",children:[(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Scope"}),": Moqui ",(0,s.jsx)(r.code,{children:"shipping-aggregator"})," component as deployed in ADOC",(0,s.jsx)(r.br,{}),"\n",(0,s.jsx)(r.strong,{children:"Last updated"}),": 2026-02-20",(0,s.jsx)(r.br,{}),"\n",(0,s.jsx)(r.strong,{children:"Primary source"}),": ",(0,s.jsx)(r.code,{children:"moqui-copy/moqui-framework/runtime/component/shipping-aggregator/"})]}),"\n"]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"table-of-contents",children:"Table of Contents"}),(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#1-system-overview",children:"System Overview"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#2-moqui--ofbiz-integration-boundary",children:"Moqui \u2194 OFBiz Integration Boundary"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#3-core-architecture-the-plugin-pattern",children:"Core Architecture: The Plugin Pattern"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#4-entity-model--configuration-data",children:"Entity Model & Configuration Data"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#5-rest-api-surface",children:"REST API Surface"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#6-authentication--token-management",children:"Authentication & Token Management"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#7-label-generation--full-lifecycle",children:"Label Generation \u2014 Full Lifecycle"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#8-rate-shopping--full-lifecycle",children:"Rate Shopping \u2014 Full Lifecycle"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#9-label-voiding-refund--full-lifecycle",children:"Label Voiding (Refund) \u2014 Full Lifecycle"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#10-webhook--order-status-callback",children:"Webhook / Order Status Callback"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#11-carrier-integration-details",children:"Carrier Integration Details"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#12-error-handling--logging",children:"Error Handling & Logging"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#13-configuration-reference",children:"Configuration Reference"})}),"\n"]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"1-system-overview",children:"1. System Overview"}),(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.strong,{children:"Shipping Aggregator"})," is a Moqui framework component that acts as a ",(0,s.jsx)(r.strong,{children:"carrier-agnostic shipping gateway hub"}),". It receives shipping requests from OFBiz OMS (via REST HTTP calls), resolves the correct carrier and configuration from the requesting user's identity, then invokes a carrier-specific implementation, normalizes the response, and returns it to OFBiz."]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         HTTP REST          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502   Moqui: shipping-aggregator component     \u2502\n\u2502   OFBiz OMS           \u2502                            \u2502                                            \u2502\n\u2502  (order management,   \u2502 \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   fulfillment,        \u2502    JSON response map        \u2502  \u2502 GenericShippingServices.xml           \u2502  \u2502\n\u2502   label printing)     \u2502                            \u2502  \u2502  - get#ShippingRate                  \u2502  \u2502\n\u2502                       \u2502                            \u2502  \u2502  - request#ShippingLabel             \u2502  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                            \u2502  \u2502  - refund#ShippingLabel              \u2502  \u2502\n                                                     \u2502  \u2502  - get#Manifest                      \u2502  \u2502\n                                                     \u2502  \u2502  - post#Order / delete#Order         \u2502  \u2502\n                                                     \u2502  \u2502  - get#Departments / Municipalities  \u2502  \u2502\n                                                     \u2502  \u2502  - post#OrderStatus (webhook in)     \u2502  \u2502\n                                                     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n                                                     \u2502                    \u2502                       \u2502\n                                                     \u2502                    \u25bc                       \u2502\n                                                     \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n                                                     \u2502  \u2502 get#ShippingGatewayDetails           \u2502  \u2502\n                                                     \u2502  \u2502 (resolves carrier from user identity)\u2502  \u2502\n                                                     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n                                                     \u2502                    \u2502                       \u2502\n                                                     \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n                                                     \u2502         \u2502  Carrier Service       \u2502          \u2502\n                                                     \u2502         \u2502 (dynamic dispatch via  \u2502          \u2502\n                                                     \u2502         \u2502  ShippingGatewayConfig)\u2502          \u2502\n                                                     \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n                                                     \u2502                    \u2502                       \u2502\n                                                     \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n                                                     \u2502         \u2502  GenericHandlerService \u2502          \u2502\n                                                     \u2502         \u2502 (optional normalizer)  \u2502          \u2502\n                                                     \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n                                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                                          \u2502\n                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                        \u25bc            \u25bc                    \u25bc              \u25bc\n                                     FORZA         C807           TERMINAL_EXPRESS    MOOVIN / DRIVIN / etc.\n                                  (Guatemala)   (Honduras,SV)    (Costa Rica)        (other carriers)\n"})}),(0,s.jsx)(r.h3,{id:"key-design-decisions",children:"Key Design Decisions"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Decision"}),(0,s.jsx)(r.th,{children:"Implementation"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Carrier routing"})}),(0,s.jsxs)(r.td,{children:["Based on user's ",(0,s.jsx)(r.code,{children:"partyId"})," \u2192 ",(0,s.jsx)(r.code,{children:"PartyRelationship"})," \u2192 ",(0,s.jsx)(r.code,{children:"ShippingGatewayConfigId"})," setting"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Service dispatch"})}),(0,s.jsxs)(r.td,{children:["Dynamic \u2014 service names stored in DB (",(0,s.jsx)(r.code,{children:"ShippingGatewayConfig"}),", ",(0,s.jsx)(r.code,{children:"ShippingGatewayOption"}),")"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Authentication"})}),(0,s.jsxs)(r.td,{children:["Centralized ",(0,s.jsx)(r.code,{children:"get#Token"})," with distributed cache (no re-auth per request)"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Response normalization"})}),(0,s.jsxs)(r.td,{children:["Optional per-carrier handler via ",(0,s.jsx)(r.code,{children:"ShippingGatewayOption"})," (",(0,s.jsx)(r.code,{children:"service.name.handle.get.label"}),", etc.)"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Multi-tenancy"})}),(0,s.jsxs)(r.td,{children:["Each tenant (ADOC, ADOC_HN, ADOC_SV) has separate ",(0,s.jsx)(r.code,{children:"PartyRelationship"})," and settings"]})]})]})]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"2-moqui--ofbiz-integration-boundary",children:"2. Moqui \u2194 OFBiz Integration Boundary"}),(0,s.jsxs)(r.p,{children:["OFBiz and Moqui are ",(0,s.jsx)(r.strong,{children:"separate applications"})," that communicate over HTTP REST. OFBiz acts as the API consumer; Moqui acts as the shipping service provider."]}),(0,s.jsx)(r.h3,{id:"how-ofbiz-calls-moqui",children:"How OFBiz Calls Moqui"}),(0,s.jsxs)(r.p,{children:["OFBiz constructs a REST ",(0,s.jsx)(r.code,{children:"POST"})," request with a JSON body and an ",(0,s.jsx)(r.code,{children:"Authorization: Basic <base64>"})," header. The request is sent to one of Moqui's ",(0,s.jsx)(r.code,{children:"shipping.rest.xml"})," endpoints."]}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Authentication header"}),": OFBiz authenticates using Moqui user credentials. Each ADOC instance has a dedicated Moqui ",(0,s.jsx)(r.code,{children:"UserAccount"})," (e.g., ",(0,s.jsx)(r.code,{children:"adoc"}),", ",(0,s.jsx)(r.code,{children:"adochn"}),", ",(0,s.jsx)(r.code,{children:"adocsv"}),") whose ",(0,s.jsx)(r.code,{children:"partyId"})," determines the carrier lookup."]}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Key Moqui user accounts per instance:"})}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Moqui UserAccount"}),(0,s.jsx)(r.th,{children:"Username"}),(0,s.jsx)(r.th,{children:"Party ID"}),(0,s.jsx)(r.th,{children:"Instance"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"adoc"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:"Guatemala/main"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_HN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"adochn"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_HN"})}),(0,s.jsx)(r.td,{children:"Honduras"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_SV"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"adocsv"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_SV"})}),(0,s.jsx)(r.td,{children:"El Salvador"})]})]})]}),(0,s.jsx)(r.admonition,{title:"Critical Identity Logic",type:"danger",children:(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"partyId"})," of the logged-in Moqui user is the anchor for all carrier resolution. This is set at the time of the REST call via the ",(0,s.jsx)(r.code,{children:"Authorization"})," header."]})}),(0,s.jsx)(r.h3,{id:"data-ofbiz-sends-to-moqui",children:"Data OFBiz Sends to Moqui"}),(0,s.jsx)(r.p,{children:"OFBiz enriches the request with data pulled from its own entities:"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Field Category"}),(0,s.jsx)(r.th,{children:"Fields Sent"}),(0,s.jsx)(r.th,{children:"Source in OFBiz"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Origin address"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"toName"}),", ",(0,s.jsx)(r.code,{children:"address1"}),", ",(0,s.jsx)(r.code,{children:"address2"}),", ",(0,s.jsx)(r.code,{children:"city"}),", ",(0,s.jsx)(r.code,{children:"stateOrProvinceCode"}),", ",(0,s.jsx)(r.code,{children:"countryCode"}),", ",(0,s.jsx)(r.code,{children:"phoneNumber"}),", ",(0,s.jsx)(r.code,{children:"emailAddress"}),", ",(0,s.jsx)(r.code,{children:"warehouseId"})]}),(0,s.jsx)(r.td,{children:"Facility postal address"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Destination address"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"toName"}),", ",(0,s.jsx)(r.code,{children:"address1"}),", ",(0,s.jsx)(r.code,{children:"address2"}),", ",(0,s.jsx)(r.code,{children:"city"}),", ",(0,s.jsx)(r.code,{children:"stateOrProvinceCode"}),", ",(0,s.jsx)(r.code,{children:"province"}),", ",(0,s.jsx)(r.code,{children:"canton"}),", ",(0,s.jsx)(r.code,{children:"district"}),", ",(0,s.jsx)(r.code,{children:"countryCode"}),", ",(0,s.jsx)(r.code,{children:"phoneNumber"}),", ",(0,s.jsx)(r.code,{children:"emailAddress"}),", ",(0,s.jsx)(r.code,{children:"stateName"})]}),(0,s.jsx)(r.td,{children:"Order ship-to address + order attributes"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Parcels"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"weight"}),", ",(0,s.jsx)(r.code,{children:"weightUnit"}),", ",(0,s.jsx)(r.code,{children:"weightUomId"}),", ",(0,s.jsx)(r.code,{children:"length"}),", ",(0,s.jsx)(r.code,{children:"width"}),", ",(0,s.jsx)(r.code,{children:"height"}),", ",(0,s.jsx)(r.code,{children:"currency"}),", ",(0,s.jsx)(r.code,{children:"fragile"})]}),(0,s.jsx)(r.td,{children:"Shipment packages"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Order info"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"orderId"}),", ",(0,s.jsx)(r.code,{children:"orderName"}),", ",(0,s.jsx)(r.code,{children:"orderNumber"}),", ",(0,s.jsx)(r.code,{children:"orderDate"}),", ",(0,s.jsx)(r.code,{children:"ticketNumber"}),", ",(0,s.jsx)(r.code,{children:"dateOfSale"})]}),(0,s.jsx)(r.td,{children:"Order header"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Business rules"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"cod"})," (boolean), ",(0,s.jsx)(r.code,{children:"validShipmentTotal"}),", ",(0,s.jsx)(r.code,{children:"paymentStatusId"}),", ",(0,s.jsx)(r.code,{children:"shipmentMethodTypeId"})]}),(0,s.jsx)(r.td,{children:"Order payment + fulfillment"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Carrier hint"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"carrierPartyId"})," (optional)"]}),(0,s.jsx)(r.td,{children:"Carrier assignment"})]})]})]}),(0,s.jsx)(r.h3,{id:"data-moqui-returns-to-ofbiz",children:"Data Moqui Returns to OFBiz"}),(0,s.jsxs)(r.p,{children:["Moqui always returns a ",(0,s.jsx)(r.code,{children:"responseMap"})," JSON object. Successful responses include:"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n  "success": true,\n  "shippingLabelMap": {\n    "referenceNumber": "123456",\n    "packages": [\n      { "trackingIdNumber": "TRK001" }\n    ]\n  },\n  "artifacts": [ ... ]\n}\n'})}),(0,s.jsx)(r.p,{children:"Error responses:"}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n  "success": false,\n  "errorMessages": "No carrier found"\n}\n'})}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"3-core-architecture-the-plugin-pattern",children:"3. Core Architecture: The Plugin Pattern"}),(0,s.jsxs)(r.p,{children:["Every top-level generic service follows the ",(0,s.jsx)(r.strong,{children:"same 5-step pipeline"}),":"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"1. get#ShippingGatewayDetails   \u2192 Resolve carrier from user identity\n2. validate#RequiredParameters  \u2192 Validate mandatory inputs\n3. ShippingGatewayConfig lookup \u2192 Find the right carrier service name\n4. Dynamic carrier service call \u2192 Invoke carrier-specific implementation\n5. GenericHandlerServices call  \u2192 Optional carrier-specific response normalization\n"})}),(0,s.jsxs)(r.h3,{id:"step-1--getshippinggatewaydetails",children:["Step 1 \u2014 ",(0,s.jsx)(r.code,{children:"get#ShippingGatewayDetails"})]}),(0,s.jsxs)(r.p,{children:["This is the carrier resolution ",(0,s.jsx)(r.strong,{children:"keystone"})," service. It is ",(0,s.jsx)(r.code,{children:'allow-remote="false"'})," (internal only)."]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xml",children:'\x3c!-- Pseudocode of the logic --\x3e\nuserPartyId = ec.user.userAccount.partyId  // from HTTP Basic Auth\n\nif (carrierPartyId is null):\n    lookup PartyRelationship WHERE:\n        fromPartyId  = userPartyId\n        fromRoleTypeId = "Client"\n        toRoleTypeId   = "Carrier"\n        relationshipTypeEnumId = "DefaultCarrier"\nelse:\n    lookup PartyRelationship WHERE:\n        fromPartyId  = userPartyId\n        fromRoleTypeId = "Client"\n        toPartyId    = carrierPartyId\n        toRoleTypeId   = "Carrier"\n        relationshipTypeEnumId = "ClientCarrier"\n\nlookup PartyRelationshipSetting WHERE:\n    partyRelationshipId = partyRelationship.partyRelationshipId\n    partySettingTypeId  = "ShippingGatewayConfigId"\n\nreturn: {\n  success: true,\n  userPartyId, carrierPartyId,\n  partyRelationshipId,\n  shippingGatewayConfigId: partyRelationshipSetting.settingValue\n}\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Entity flow diagram:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'UserAccount.partyId\n       \u2502\n       \u25bc\nPartyRelationship  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  fromPartyId = userPartyId (Client role)                                                          \u2502\n  toPartyId   = carrierPartyId (Carrier role)                                                      \u2502\n  relationshipTypeEnumId = "ClientCarrier" (or "DefaultCarrier")                                  \u2502\n       \u2502                                                                                           \u2502\n       \u25bc                        yields partyRelationshipId                                         \u2502\nPartyRelationshipSetting                                                                           \u2502\n  partySettingTypeId = "ShippingGatewayConfigId"                                                  \u2502\n  settingValue = "FORZA" / "C807" / "TERMINAL_EXPRESS" / ...         \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\nShippingGatewayConfig.shippingGatewayConfigId = settingValue\n'})}),(0,s.jsx)(r.h3,{id:"step-3--service-name-resolution-via-shippinggatewayconfig",children:"Step 3 \u2014 Service Name Resolution via ShippingGatewayConfig"}),(0,s.jsxs)(r.p,{children:["For ",(0,s.jsx)(r.strong,{children:"label requests"}),", the service name comes from ",(0,s.jsx)(r.code,{children:"ShippingGatewayConfig.requestLabelsServiceName"}),":"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xml",children:'<ShippingGatewayConfig shippingGatewayConfigId="FORZA"\n  requestLabelsServiceName="co.hotwax.shippingAggregator.forza.ForzaServices.request#ForzaShippingLabel"\n  getRateServiceName="co.hotwax.shippingAggregator.forza.ForzaServices.get#ForzaShippingRate"\n  refundLabelsServiceName="co.hotwax.shippingAggregator.forza.ForzaServices.refund#ForzaShippingLabel"/>\n'})}),(0,s.jsxs)(r.p,{children:["For ",(0,s.jsx)(r.strong,{children:"extended operations"})," (manifest, postOrder, deleteOrder, departments, municipalities), the service name comes from ",(0,s.jsx)(r.code,{children:"ShippingGatewayOption"}),":"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xml",children:'<ShippingGatewayOption\n  shippingGatewayConfigId="C807"\n  optionEnumId="service.name.get.manifest"\n  optionValue="co.hotwax.shippingAggregator.c807.C807Services.get#C807Manifest"/>\n'})}),(0,s.jsx)(r.h3,{id:"step-4--dynamic-dispatch",children:"Step 4 \u2014 Dynamic Dispatch"}),(0,s.jsx)(r.p,{children:"Moqui's service engine resolves service names at runtime:"}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xml",children:'<service-call name="${shippingGatewayConfig.requestLabelsServiceName}" out-map="responseMap" in-map="context"/>\n'})}),(0,s.jsxs)(r.p,{children:["The entire ",(0,s.jsx)(r.code,{children:"context"})," (all input parameters) is passed through to the carrier service. No filtering \u2014 carriers pick what they need."]}),(0,s.jsx)(r.h3,{id:"step-5--handler-normalization",children:"Step 5 \u2014 Handler Normalization"}),(0,s.jsxs)(r.p,{children:["After the carrier call completes, a ",(0,s.jsx)(r.strong,{children:"handler service"})," is optionally invoked using a ",(0,s.jsx)(r.code,{children:"ShippingGatewayOption"}),":"]}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Handler Option Enum"}),(0,s.jsx)(r.th,{children:"Purpose"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.label"})}),(0,s.jsx)(r.td,{children:"Normalizes label response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.rate"})}),(0,s.jsx)(r.td,{children:"Normalizes rate response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.void.label"})}),(0,s.jsx)(r.td,{children:"Normalizes void response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.post.order"})}),(0,s.jsx)(r.td,{children:"Normalizes post-order response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.delete.order"})}),(0,s.jsx)(r.td,{children:"Normalizes delete-order response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.manifest"})}),(0,s.jsx)(r.td,{children:"Normalizes manifest response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.departments"})}),(0,s.jsx)(r.td,{children:"Normalizes departments response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.municipalities"})}),(0,s.jsx)(r.td,{children:"Normalizes municipalities response"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.webhook.response"})}),(0,s.jsx)(r.td,{children:"Handles inbound carrier webhook"})]})]})]}),(0,s.jsx)(r.p,{children:"If no handler option is configured, the raw carrier response is returned as-is."}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"4-entity-model--configuration-data",children:"4. Entity Model & Configuration Data"}),(0,s.jsx)(r.h3,{id:"core-mantle-entities-used",children:"Core Mantle Entities Used"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Entity"}),(0,s.jsx)(r.th,{children:"Key Fields"}),(0,s.jsx)(r.th,{children:"Purpose"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mantle.party.Party"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"partyId"}),", ",(0,s.jsx)(r.code,{children:"partyTypeEnumId"})]}),(0,s.jsx)(r.td,{children:"Represents clients (ADOC) and carriers (FORZA, C807, etc.)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mantle.party.PartyRelationship"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"fromPartyId"}),", ",(0,s.jsx)(r.code,{children:"toPartyId"}),", ",(0,s.jsx)(r.code,{children:"relationshipTypeEnumId"}),", ",(0,s.jsx)(r.code,{children:"partyRelationshipId"})]}),(0,s.jsx)(r.td,{children:"Links a client party to a carrier party"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mantle.party.PartyRelationshipSetting"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"partyRelationshipId"}),", ",(0,s.jsx)(r.code,{children:"partySettingTypeId"}),", ",(0,s.jsx)(r.code,{children:"settingValue"})]}),(0,s.jsx)(r.td,{children:"Stores per-relationship credential/config key-value pairs"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mantle.shipment.carrier.ShippingGatewayConfig"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"shippingGatewayConfigId"}),", ",(0,s.jsx)(r.code,{children:"requestLabelsServiceName"}),", ",(0,s.jsx)(r.code,{children:"getRateServiceName"}),", ",(0,s.jsx)(r.code,{children:"refundLabelsServiceName"})]}),(0,s.jsx)(r.td,{children:"Maps a carrier config ID to its service implementations"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mantle.shipment.carrier.ShippingGatewayOption"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"shippingGatewayConfigId"}),", ",(0,s.jsx)(r.code,{children:"optionEnumId"}),", ",(0,s.jsx)(r.code,{children:"optionValue"})]}),(0,s.jsx)(r.td,{children:"Stores carrier-specific endpoint URLs and handler service names"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"mantle.shipment.carrier.ShippingGatewayCarrier"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"shippingGatewayConfigId"}),", ",(0,s.jsx)(r.code,{children:"carrierPartyId"})]}),(0,s.jsx)(r.td,{children:"Links a gateway config to a carrier party (used for token cache key)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"moqui.security.UserAccount"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"userId"}),", ",(0,s.jsx)(r.code,{children:"username"}),", ",(0,s.jsx)(r.code,{children:"partyId"})]}),(0,s.jsx)(r.td,{children:"Moqui user that represents each OFBiz tenant instance"})]})]})]}),(0,s.jsxs)(r.h3,{id:"partysettingtype-values",children:[(0,s.jsx)(r.code,{children:"PartySettingType"})," Values"]}),(0,s.jsxs)(r.p,{children:["These are the keys used in ",(0,s.jsx)(r.code,{children:"PartyRelationshipSetting"}),". Each is loaded by ",(0,s.jsx)(r.code,{children:"TypeData.xml"}),":"]}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Setting Key"}),(0,s.jsx)(r.th,{children:"Description"}),(0,s.jsx)(r.th,{children:"Used By"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ShippingGatewayConfigId"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.strong,{children:"Required"})," \u2014 resolves which gateway config to use"]}),(0,s.jsx)(r.td,{children:"All carriers"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"Username"})}),(0,s.jsx)(r.td,{children:"API username"}),(0,s.jsx)(r.td,{children:"C807, TerminalExpress, Moovin"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"Password"})}),(0,s.jsx)(r.td,{children:"API password"}),(0,s.jsx)(r.td,{children:"C807, TerminalExpress, Moovin"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ClientId"})}),(0,s.jsx)(r.td,{children:"API client ID"}),(0,s.jsx)(r.td,{children:"C807, TerminalExpress, Forza, CargoTrans"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ClientSecretKey"})}),(0,s.jsx)(r.td,{children:"OAuth2 client secret or HMAC key"}),(0,s.jsx)(r.td,{children:"Forza, CargoTrans"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"CodApp"})}),(0,s.jsx)(r.td,{children:'Forza-specific "app" identifier'}),(0,s.jsx)(r.td,{children:"Forza"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"AccountNumber"})}),(0,s.jsx)(r.td,{children:"Carrier account number"}),(0,s.jsx)(r.td,{children:"Forza"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"CodeOfReference"})}),(0,s.jsxs)(r.td,{children:["Default facility code (overridable by ",(0,s.jsx)(r.code,{children:"facilityIdentification"}),")"]}),(0,s.jsx)(r.td,{children:"Forza"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ReverseLogistics"})}),(0,s.jsx)(r.td,{children:"Y/N flag for return shipment"}),(0,s.jsx)(r.td,{children:"TerminalExpress"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ApiKey"})}),(0,s.jsx)(r.td,{children:"Raw API key"}),(0,s.jsx)(r.td,{children:"CitiExpress"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ApiToken"})}),(0,s.jsx)(r.td,{children:"Bearer-style token"}),(0,s.jsx)(r.td,{children:"Drivin"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"EndPoint"})}),(0,s.jsx)(r.td,{children:"Override base URL for the carrier API"}),(0,s.jsx)(r.td,{children:"C807, (others optional)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"AuthType"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"BASIC_AUTH"})," or ",(0,s.jsx)(r.code,{children:"OAUTH2"})]}),(0,s.jsxs)(r.td,{children:["Used by ",(0,s.jsx)(r.code,{children:"get#Token"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"SendSharedSecretKey"})}),(0,s.jsx)(r.td,{children:"Refresh token for OAuth2 token refresh"}),(0,s.jsx)(r.td,{children:"OAuth2 flow"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ClientUrl"})}),(0,s.jsx)(r.td,{children:"OFBiz base URL (for webhook callback)"}),(0,s.jsx)(r.td,{children:"C807 (SV, HN)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ClientOrderEndpoint"})}),(0,s.jsx)(r.td,{children:"OFBiz endpoint path for status callbacks"}),(0,s.jsx)(r.td,{children:"C807 (SV, HN)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ClientAuthKey"})}),(0,s.jsx)(r.td,{children:"Base64 Basic auth for callback to OFBiz"}),(0,s.jsx)(r.td,{children:"C807 (SV, HN)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"LabelType"})}),(0,s.jsx)(r.td,{children:"Label format type"}),(0,s.jsx)(r.td,{children:"varies"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"PaymentType"})}),(0,s.jsx)(r.td,{children:"Payment type code"}),(0,s.jsx)(r.td,{children:"varies"})]})]})]}),(0,s.jsxs)(r.h3,{id:"shippinggatewayoption-optionenumid-values",children:[(0,s.jsx)(r.code,{children:"ShippingGatewayOption"})," ",(0,s.jsx)(r.code,{children:"optionEnumId"})," Values"]}),(0,s.jsx)(r.p,{children:"These control endpoint URLs and extended service names:"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Option Enum ID"}),(0,s.jsx)(r.th,{children:"Typical Value Type"}),(0,s.jsx)(r.th,{children:"Example"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint"})}),(0,s.jsx)(r.td,{children:"Base URL of carrier API"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"https://api.forza.com/"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.accessToken"})}),(0,s.jsx)(r.td,{children:"Token endpoint path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/oauth/token"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.shipment.rate"})}),(0,s.jsx)(r.td,{children:"Rate query path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rates"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.shipments.labels"})}),(0,s.jsx)(r.td,{children:"Label creation path"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"/labels"})," or ",(0,s.jsx)(r.code,{children:"Paquetes/crearOrden/"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.shipments.void"})}),(0,s.jsx)(r.td,{children:"Void label path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/labels/{id}/void"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.shipments.manifest"})}),(0,s.jsx)(r.td,{children:"Manifest path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/manifests"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.municipalities"})}),(0,s.jsx)(r.td,{children:"Municipality lookup path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/municipalities"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.departments"})}),(0,s.jsx)(r.td,{children:"Department lookup path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/departments"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.post.order"})}),(0,s.jsx)(r.td,{children:"Post order path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/orders"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"endPoint.delete.order"})}),(0,s.jsx)(r.td,{children:"Delete order path"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/orders/{id}"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.label"})}),(0,s.jsx)(r.td,{children:"Handler service for label response"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"...handle#C807LabelResponseHandler"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.get.rate"})}),(0,s.jsx)(r.td,{children:"Handler service for rate response"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"...handle#ForzaRateResponseHandler"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.void.label"})}),(0,s.jsx)(r.td,{children:"Handler service for void response"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"...handle#C807VoidLabelResponseHandler"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"service.name.handle.webhook.response"})}),(0,s.jsx)(r.td,{children:"Handler for inbound webhooks"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"...handle#C807WebhookResponseHandler"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"LabelRequestTemplate"})}),(0,s.jsx)(r.td,{children:"Template enum"}),(0,s.jsx)(r.td,{children:"FTL template path"})]})]})]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"5-rest-api-surface",children:"5. REST API Surface"}),(0,s.jsxs)(r.p,{children:["File: ",(0,s.jsx)(r.code,{children:"service/shipping.rest.xml"}),(0,s.jsx)(r.br,{}),"\n","All endpoints use ",(0,s.jsx)(r.code,{children:'require-authentication="anonymous-all"'})," \u2014 meaning OFBiz passes credentials via ",(0,s.jsx)(r.code,{children:"Authorization: Basic <base64(user:pass)>"}),"."]}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"HTTP Method"}),(0,s.jsx)(r.th,{children:"Path"}),(0,s.jsx)(r.th,{children:"Moqui Service"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/shippingRate"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.get#ShippingRate"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/shippingLabel"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.request#ShippingLabel"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/manifest"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.get#Manifest"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/refundShippingLabel"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.refund#ShippingLabel"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/postOrder"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.post#Order"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/deleteOrder"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.delete#Order"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/getDepartments"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.get#Departments"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/getMunicipalities"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.get#Municipalities"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"POST"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/rest/s1/shipping/orderStatus"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"GenericShippingServices.post#OrderStatus"})})]})]})]}),(0,s.jsxs)(r.p,{children:["Party REST (",(0,s.jsx)(r.code,{children:"party.rest.xml"}),"): Standard Mantle party management endpoints (find/create parties, roles) \u2014 not shipping-specific."]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"6-authentication--token-management",children:"6. Authentication & Token Management"}),(0,s.jsx)(r.h3,{id:"overview",children:"Overview"}),(0,s.jsxs)(r.p,{children:["Carriers use different authentication mechanisms. The system centralizes token acquisition in ",(0,s.jsx)(r.code,{children:"HelperServices.get#Token"}),"."]}),(0,s.jsxs)(r.h3,{id:"gettoken-flow",children:[(0,s.jsx)(r.code,{children:"get#Token"})," Flow"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'1. Check distributed cache:\n   key = "${partyRelationshipId}_accessToken"\n   cache name = carrierPartyId\n\n2. Cache HIT + isRefresh=false \u2192 return cached token immediately (no API call)\n\n3. Cache MISS or isRefresh=true:\n   a. Load ShippingGatewayConfigOptions (endPoints) and PartyRelationshipSettings (credentials)\n   b. Read settingsMap[\'AuthType\']:\n      - "BASIC_AUTH" \u2192 restClient.basicAuth(username, password)\n      - otherwise (OAuth2):\n          if SendSharedSecretKey present:\n            grant_type=refresh_token, refresh_token=<SendSharedSecretKey>\n          elif password present:\n            grant_type=password, username=..., password=...\n          else:\n            grant_type=client_credentials, client_id=..., client_secret=...\n   c. POST to: (settingsMap.EndPoint OR optionsMap.endPoint) + optionsMap[\'endPoint.accessToken\']\n   d. On 2xx: cache access_token in distributed cache (putIfAbsent)\n   e. Return { success: true, access_token: "..." }\n'})}),(0,s.jsx)(r.h3,{id:"carrier-auth-patterns",children:"Carrier Auth Patterns"}),(0,s.jsxs)(t.A,{children:[(0,s.jsx)(c.A,{value:"forza",label:"Forza",default:!0,children:(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Auth Method:"})," HMAC-SHA256 signature (",(0,s.jsx)(r.code,{children:"LauValue"})," header) + Base64 payload encoding\n",(0,s.jsx)(r.strong,{children:"Cache Strategy:"})," No token needed \u2014 signature computed per request"]})}),(0,s.jsx)(c.A,{value:"c807",label:"C807",children:(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Auth Method:"})," OAuth2 Bearer token\n",(0,s.jsx)(r.strong,{children:"Cache Strategy:"})," Cached per ",(0,s.jsx)(r.code,{children:"partyRelationshipId"})]})}),(0,s.jsx)(c.A,{value:"terminal",label:"Terminal Express",children:(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Auth Method:"})," HTTP Basic Auth (",(0,s.jsx)(r.code,{children:"username:password"}),")\n",(0,s.jsx)(r.strong,{children:"Cache Strategy:"})," No token needed \u2014 sent per request"]})}),(0,s.jsx)(c.A,{value:"others",label:"Moovin / Drivin / CitiExpress...",children:(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Moovin"}),": OAuth2 or Basic Auth (Cached if OAuth2)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"CitiExpress"}),": API Key in header (No token needed)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Drivin"}),": Bearer API Token (static) (Stored in ",(0,s.jsx)(r.code,{children:"ApiToken"})," setting)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"CargoTrans"}),": OAuth2 client_credentials (Cached)"]}),"\n"]})})]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"7-label-generation--full-lifecycle",children:"7. Label Generation \u2014 Full Lifecycle"}),(0,s.jsx)(r.h3,{id:"entry-point",children:"Entry Point"}),(0,s.jsxs)(r.p,{children:["OFBiz POSTs to ",(0,s.jsx)(r.code,{children:"/rest/s1/shipping/shippingLabel"})," with a JSON body containing shipment data."]}),(0,s.jsx)(r.h3,{id:"required-input-fields",children:"Required Input Fields"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Field"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Required"}),(0,s.jsx)(r.th,{children:"Source"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.toName"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Facility name"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.address1"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Facility address"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.city"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Facility city"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.stateOrProvinceCode"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (Forza)"}),(0,s.jsx)(r.td,{children:"Facility state code"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.countryCode"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Facility country"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.phoneNumber"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (some)"}),(0,s.jsx)(r.td,{children:"Facility phone"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"originAddress.warehouseId"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (TerminalExpress)"}),(0,s.jsx)(r.td,{children:"Carrier warehouse ID"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.toName"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Customer name"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.address1"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Shipping address"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.city"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Customer city"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.stateOrProvinceCode"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"State code"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.province"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (TerminalExpress)"}),(0,s.jsx)(r.td,{children:"Province name"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.canton"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (TerminalExpress)"}),(0,s.jsx)(r.td,{children:"Canton"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.district"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (TerminalExpress)"}),(0,s.jsx)(r.td,{children:"District"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.phoneNumber"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Customer phone"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.emailAddress"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Rec."}),(0,s.jsx)(r.td,{children:"Customer email"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"destAddress.stateName"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (C807)"}),(0,s.jsx)(r.td,{children:"State name for C807 lookup"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"parcels"})}),(0,s.jsx)(r.td,{children:"List"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsxs)(r.td,{children:["Array of ",(0,s.jsx)(r.code,{children:"{weight, weightUnit, length, width, height}"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"weightAmount"})}),(0,s.jsx)(r.td,{children:"Decimal"}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Total shipment weight"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"dateOfSale"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (most)"}),(0,s.jsx)(r.td,{children:"Shipment date (YYYY-MM-DD)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"orderId"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Optional"}),(0,s.jsx)(r.td,{children:"OFBiz order ID"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"orderName"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (C807)"}),(0,s.jsx)(r.td,{children:"Order reference name"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"orderNumber"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (Forza, digits only)"}),(0,s.jsx)(r.td,{children:"Carrier order number"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"cod"})}),(0,s.jsx)(r.td,{children:'String "true"/"false"'}),(0,s.jsx)(r.td,{children:"Yes"}),(0,s.jsx)(r.td,{children:"Cash on delivery flag"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"validShipmentTotal"})}),(0,s.jsx)(r.td,{children:"Decimal"}),(0,s.jsx)(r.td,{children:"COD only"}),(0,s.jsx)(r.td,{children:"COD amount"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"paymentStatusId"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (C807)"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"PAYMENT_NOT_RECEIVED"})," etc."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"shipmentMethodTypeId"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Yes (C807)"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"SHIP_TO_STORE"})," etc."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"facilityIdentification"})}),(0,s.jsx)(r.td,{children:"String"}),(0,s.jsx)(r.td,{children:"Optional"}),(0,s.jsxs)(r.td,{children:["Overrides ",(0,s.jsx)(r.code,{children:"CodeOfReference"})]})]})]})]}),(0,s.jsx)(r.h3,{id:"complete-call-sequence",children:"Complete Call Sequence"}),(0,s.jsx)(r.mermaid,{value:"sequenceDiagram\n    participant OFBiz\n    participant Moqui_Generic as GenericShippingServices\n    participant GWDetails as get#ShippingGatewayDetails\n    participant Validator as validate#RequiredParameters\n    participant DB as Moqui DB\n    participant CarrierSvc as Carrier Service (e.g. ForzaServices)\n    participant CarrierAPI as External Carrier API\n    participant Handler as GenericHandlerServices\n\n    OFBiz->>Moqui_Generic: POST /shippingLabel (JSON body, Basic Auth)\n    Moqui_Generic->>GWDetails: get#ShippingGatewayDetails(carrierPartyId?)\n    GWDetails->>DB: find PartyRelationship (userPartyId \u2192 carrier)\n    DB--\x3e>GWDetails: partyRelationship + settings\n    GWDetails--\x3e>Moqui_Generic: {shippingGatewayConfigId, partyRelationshipId, ...}\n    Moqui_Generic->>Validator: validate destAddress, originAddress not null\n    Moqui_Generic->>DB: find ShippingGatewayConfig (requestLabelsServiceName)\n    DB--\x3e>Moqui_Generic: requestLabelsServiceName\n    Moqui_Generic->>CarrierSvc: dynamic call to requestLabelsServiceName (all context)\n    CarrierSvc->>DB: get ShippingGatewayConfigOptions (endpoints)\n    CarrierSvc->>DB: get PartyRelationshipSettings (credentials)\n    CarrierSvc->>CarrierSvc: validate carrier-specific required fields\n    note over CarrierSvc: (auth, build payload, sign if needed)\n    CarrierSvc->>CarrierAPI: POST label request\n    CarrierAPI--\x3e>CarrierSvc: label response (JSON)\n    CarrierSvc--\x3e>Moqui_Generic: responseMap\n    Moqui_Generic->>Handler: handle#ShippingLabel(shippingGatewayConfigId, responseMap)\n    Handler->>DB: find ShippingGatewayOption (service.name.handle.get.label)\n    DB--\x3e>Handler: handler service name\n    Handler->>CarrierSvc: call handler service\n    CarrierSvc--\x3e>Handler: normalized responseMap\n    Handler--\x3e>Moqui_Generic: normalized responseMap\n    Moqui_Generic--\x3e>OFBiz: JSON responseMap"}),(0,s.jsx)(r.h3,{id:"interactive-payload-simulator",children:"Interactive Payload Simulator"}),(0,s.jsx)(r.p,{children:"Use the simulator below to explore how the Generic payload structures adapt into Custom Carrier payloads for a Label Request."}),(0,s.jsx)(x,{}),(0,s.jsx)(r.h3,{id:"per-carrier-label-request-construction",children:"Per-Carrier Label Request Construction"}),(0,s.jsx)(r.h4,{id:"forza-guatemala",children:"Forza (Guatemala)"}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Validation:"})}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"shippingGatewayConfigId"}),", ",(0,s.jsx)(r.code,{children:"dateOfSale"}),", ",(0,s.jsx)(r.code,{children:"weightAmount"}),", ",(0,s.jsx)(r.code,{children:"countryId"}),", ",(0,s.jsx)(r.code,{children:"parcels"}),", ",(0,s.jsx)(r.code,{children:"destAddress"}),", ",(0,s.jsx)(r.code,{children:"originAddress"})," must be present"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"orderNumber"})," must be digits only"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"originAddress.stateOrProvinceCode"})," and ",(0,s.jsx)(r.code,{children:"destAddress.stateOrProvinceCode"})," must be present"]}),"\n"]}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Municipality resolution:"})}),(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["Extract department code from ",(0,s.jsx)(r.code,{children:"stateOrProvinceCode"})," (split on ",(0,s.jsx)(r.code,{children:"-"}),", take index ",(0,s.jsx)(r.code,{children:"[1]"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["Call ",(0,s.jsx)(r.code,{children:"get#ForzaMunicipality(departmentHeaderCode, countryId, city)"})," for both origin and destination"]}),"\n",(0,s.jsxs)(r.li,{children:["Retrieve ",(0,s.jsx)(r.code,{children:"HeaderCodeTownship"})," for each city"]}),"\n"]}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.strong,{children:["Request payload (Base64-encoded, wrapped in ",(0,s.jsx)(r.code,{children:"PayLoad"}),"):"]})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n  "Method": "/<endPoint.shipments.labels value>",\n  "Params": {\n    "DateOfSale": "2026-02-20",\n    "ContentDescription": "...",\n    "from_address": { "name", "phone", "email", "address1", "headerCodeTownship", "city" },\n    "to_address":   { "name", "phone", "email", "address1", "headerCodeTownship", "city" },\n    "Parcels": [...],\n    "Order_Number": "12345",\n    "Ticket_Number": "...",\n    "IdCountry": "GT",\n    "CountPieces": 1,\n    "CodeOfReference": "357506",\n    "TotalWeight": 2.5,\n    "TotalValue": 100.0,\n    "Collected": false,\n    "Currency": "USD",\n    "COD": { "CashOnDelivery": false, "AmmountCashOnDelivery": 0, "CashOnDeliveryCurrency": "USD" }\n  }\n}\n'})}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Security"}),": HMAC-SHA256 signature of the full request map using ",(0,s.jsx)(r.code,{children:"ClientSecretKey"}),", sent as ",(0,s.jsx)(r.code,{children:"LauValue"})," header. Payload is Base64-encoded using ",(0,s.jsx)(r.code,{children:"ShippingAggregatorHelper.mapToBase64(requestMap)"}),"."]}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Response decoding:"})," ",(0,s.jsx)(r.code,{children:"ShippingAggregatorHelper.decodePayLoad(responseMap)"})," decodes the Base64 response."]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h4,{id:"c807-honduras-el-salvador",children:"C807 (Honduras, El Salvador)"}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Authentication:"})," Bearer token via ",(0,s.jsx)(r.code,{children:"get#Token"})," (OAuth2 password or client_credentials flow, cached per ",(0,s.jsx)(r.code,{children:"partyRelationshipId"}),")."]}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Department/Municipality resolution:"})}),(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"get#C807MatchingDepartment(stateProvinceName)"})," \u2192 fuzzy-match against C807's department list \u2192 ",(0,s.jsx)(r.code,{children:"departmentId"})]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"get#C807MatchingMunicipality(cityName, departmentId)"})," \u2192 ",(0,s.jsx)(r.code,{children:"municipalityId"})]}),"\n"]}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"COD Logic:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-groovy",children:'if (cod == "true" && paymentStatusId == "PAYMENT_NOT_RECEIVED" && shipmentMethodTypeId != "SHIP_TO_STORE") {\n    tipo_servicio = "CCE"\n    monto_cce = validShipmentTotal\n} else {\n    tipo_servicio = "SER"\n}\n'})}),(0,s.jsx)(r.admonition,{title:"STS Logic Override",type:"note",children:(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.strong,{children:["STS (Ship-To-Store) Orders always get ",(0,s.jsx)(r.code,{children:'"SER"'})," (non-COD) regardless of payment status."]})})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Request payload:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n  "recolecta_fecha": "2026-02-20 19:00",\n  "tipo_entrega": "<shipmentMethod>",\n  "provisional": false,\n  "sede": "<facilityIdentification (optional)>",\n  "guias": [{\n    "orden": "<orderName>-<orderDate>",\n    "nombre": "<destAddress.toName>",\n    "direccion": "<address1>, <address2>",\n    "telefono": "<phoneNumber>",\n    "correo": "<emailAddress>",\n    "departamento_id": 5,\n    "municipio_id": 23,\n    "tipo_servicio": "SER",\n    "detalle": [{ "peso": 2.5, "contenido": "Package Weight", "unidad_medida": "LB" }]\n  }]\n}\n'})}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Artifact fetch:"})," After label creation, ",(0,s.jsx)(r.code,{children:"get#C807Artifacts(trackingIds)"})," is called to retrieve the label PDF/image."]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h4,{id:"terminalexpress-costa-rica",children:"TerminalExpress (Costa Rica)"}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Authentication:"})," HTTP Basic Auth (",(0,s.jsx)(r.code,{children:"username"}),", ",(0,s.jsx)(r.code,{children:"password"})," from settings \u2014 per request, no token caching)."]}),(0,s.jsxs)(r.p,{children:[(0,s.jsxs)(r.strong,{children:["Required fields in ",(0,s.jsx)(r.code,{children:"destAddress"}),":"]})," ",(0,s.jsx)(r.code,{children:"phoneNumber"}),", ",(0,s.jsx)(r.code,{children:"province"}),", ",(0,s.jsx)(r.code,{children:"canton"}),", ",(0,s.jsx)(r.code,{children:"district"}),", ",(0,s.jsx)(r.code,{children:"toName"}),(0,s.jsx)(r.br,{}),"\n",(0,s.jsxs)(r.strong,{children:["Required in ",(0,s.jsx)(r.code,{children:"originAddress"}),":"]})," ",(0,s.jsx)(r.code,{children:"warehouseId"})]}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Request payload:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\n  "PROVINCIA": "<destAddress.province>",\n  "CANTON": "<destAddress.canton>",\n  "DISTRITO": "<destAddress.district>",\n  "PESO": 2.5,\n  "CLIENTE_ID": "1506",\n  "BODEGA_ID": "<originAddress.warehouseId>",\n  "NOM_CLIENTE_FINAL": "<destAddress.toName>",\n  "TEL_CLIENTE_FINAL": "<destAddress.phoneNumber>",\n  "DIR_CLIENTE_FINAL": "<full address string>",\n  "LOGISTICA_INVERSA": "N"\n}\n'})}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Endpoint:"})," ",(0,s.jsx)(r.code,{children:"POST {endPoint}{endPoint.shipments.labels}"})," \u2192 ",(0,s.jsx)(r.code,{children:"https://sandboxlte.laterminalexpress.com/api/Paquetes/crearOrden/"})]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"8-rate-shopping--full-lifecycle",children:"8. Rate Shopping \u2014 Full Lifecycle"}),(0,s.jsx)(r.h3,{id:"entry-point-1",children:"Entry Point"}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.code,{children:"POST /rest/s1/shipping/shippingRate"})}),(0,s.jsx)(r.h3,{id:"required-input-fields-1",children:"Required Input Fields"}),(0,s.jsx)(r.p,{children:"Same address fields as label generation, plus:"}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"parcels"})," (with weight/dimensions)"]}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"weightAmount"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"currencyUomId"})}),"\n"]}),(0,s.jsx)(r.p,{children:"Optional:"}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"shipmentMethod"}),", ",(0,s.jsx)(r.code,{children:"packagingType"}),", ",(0,s.jsx)(r.code,{children:"pickupType"}),", ",(0,s.jsx)(r.code,{children:"locationId"}),", ",(0,s.jsx)(r.code,{children:"includeAlternativeRates"})]}),"\n"]}),(0,s.jsx)(r.h3,{id:"flow",children:"Flow"}),(0,s.jsx)(r.mermaid,{value:"sequenceDiagram\n    OFBiz->>GenericShipping: POST /shippingRate\n    GenericShipping->>GWDetails: get#ShippingGatewayDetails\n    GWDetails--\x3e>GenericShipping: {shippingGatewayConfigId, ...}\n    GenericShipping->>Validator: validate destAddress, originAddress\n    GenericShipping->>DB: find ShippingGatewayConfig (getRateServiceName)\n    GenericShipping->>CarrierRateSvc: dynamic call (e.g. get#ForzaShippingRate)\n    CarrierRateSvc->>CarrierAPI: rate request\n    CarrierAPI--\x3e>CarrierRateSvc: rates response\n    CarrierRateSvc--\x3e>GenericShipping: responseMap\n    GenericShipping->>Handler: handle#ShippingRate (optionally normalizes)\n    Handler--\x3e>GenericShipping: normalized responseMap\n    GenericShipping--\x3e>OFBiz: responseMap"}),(0,s.jsx)(r.h3,{id:"notes-on-rate-shopping",children:"Notes on Rate Shopping"}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"No rate aggregation across carriers"})," \u2014 each REST call targets a single carrier (determined by user's ",(0,s.jsx)(r.code,{children:"PartyRelationship"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Rate selection logic"})," is handled by OFBiz, not Moqui \u2014 Moqui returns available rates; OFBiz selects"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Forza rate endpoint"})," uses same HMAC/Base64 pattern as labels"]}),"\n",(0,s.jsxs)(r.li,{children:["Rate caching is ",(0,s.jsx)(r.strong,{children:"not implemented"})," in the current codebase \u2014 each call hits the carrier API live"]}),"\n"]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"9-label-voiding-refund--full-lifecycle",children:"9. Label Voiding (Refund) \u2014 Full Lifecycle"}),(0,s.jsx)(r.h3,{id:"entry-point-2",children:"Entry Point"}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.code,{children:"POST /rest/s1/shipping/refundShippingLabel"})}),(0,s.jsx)(r.h3,{id:"required-input-fields-2",children:"Required Input Fields"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Field"}),(0,s.jsx)(r.th,{children:"Required"}),(0,s.jsx)(r.th,{children:"Notes"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"trackingNumber"})}),(0,s.jsx)(r.td,{children:"Yes (validated)"}),(0,s.jsx)(r.td,{children:"The label tracking number to void"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"trackingIds"})}),(0,s.jsx)(r.td,{children:"Optional (List)"}),(0,s.jsx)(r.td,{children:"For batch void"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"carrierPartyId"})}),(0,s.jsx)(r.td,{children:"Optional"}),(0,s.jsxs)(r.td,{children:["If not provided, uses ",(0,s.jsx)(r.code,{children:"DefaultCarrier"})]})]})]})]}),(0,s.jsx)(r.h3,{id:"flow-1",children:"Flow"}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"OFBiz \u2192 POST /refundShippingLabel\n  \u2192 get#ShippingGatewayDetails (resolve carrier)\n  \u2192 validate#RequiredParameters(['trackingNumber'])\n  \u2192 find ShippingGatewayConfig (refundLabelsServiceName)\n  \u2192 dynamic call to refundLabelsServiceName\n      e.g. ForzaServices.refund#ForzaShippingLabel\n      e.g. C807Services.refund#C807ShippingLabel\n  \u2192 GenericHandlerServices.handle#VoidShippingLabel\n      (looks up option: service.name.handle.void.label)\n  \u2192 return responseMap to OFBiz\n"})}),(0,s.jsx)(r.h3,{id:"per-carrier-void-notes",children:"Per-Carrier Void Notes"}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.strong,{children:["Forza (",(0,s.jsx)(r.code,{children:"refundShippingLabel.groovy"}),"):"]})}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Validates ",(0,s.jsx)(r.code,{children:"shippingGatewayConfigId"}),", ",(0,s.jsx)(r.code,{children:"partyRelationshipId"}),", ",(0,s.jsx)(r.code,{children:"trackingNumber"})]}),"\n",(0,s.jsx)(r.li,{children:"Uses same HMAC-SHA256 authentication"}),"\n",(0,s.jsxs)(r.li,{children:["Calls ",(0,s.jsx)(r.code,{children:"endPoint.shipments.void"})," endpoint"]}),"\n",(0,s.jsxs)(r.li,{children:["Response decoded with ",(0,s.jsx)(r.code,{children:"decodePayLoad"})]}),"\n"]}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.strong,{children:["C807 (",(0,s.jsx)(r.code,{children:"refundShippingLabel.groovy"}),"):"]})}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Validates ",(0,s.jsx)(r.code,{children:"trackingNumber"})," and optional ",(0,s.jsx)(r.code,{children:"trackingIds"})]}),"\n",(0,s.jsxs)(r.li,{children:["Gets Bearer token via ",(0,s.jsx)(r.code,{children:"get#Token"})]}),"\n",(0,s.jsx)(r.li,{children:"Calls C807's label cancellation endpoint"}),"\n",(0,s.jsxs)(r.li,{children:["Handler normalizes response via ",(0,s.jsx)(r.code,{children:"handle#C807VoidLabelResponseHandler"})]}),"\n"]}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Void eligibility:"}),' Determined entirely by the carrier API \u2014 there is no time-window check in the Moqui layer. If the carrier returns an error (e.g., "label already shipped"), the error is propagated in ',(0,s.jsx)(r.code,{children:"errorMessages"}),"."]}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Idempotency:"}),' Not explicitly implemented \u2014 a second void call with the same tracking number is forwarded to the carrier API again. The carrier API is expected to handle duplicate void requests gracefully (typically by returning a success or "already voided" message).']}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Financial adjustments:"})," Not handled by Moqui. OFBiz is responsible for any refund or financial reversal once it receives a successful void response."]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"10-webhook--order-status-callback",children:"10. Webhook / Order Status Callback"}),(0,s.jsx)(r.h3,{id:"inbound-flow-carrier--moqui--ofbiz",children:"Inbound Flow (Carrier \u2192 Moqui \u2192 OFBiz)"}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.code,{children:"POST /rest/s1/shipping/orderStatus"})}),(0,s.jsx)(r.p,{children:"This endpoint accepts delivery status updates pushed by carriers (e.g., C807 webhooks)."}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Carrier \u2500\u2500POST\u2500\u2500\u25ba Moqui /orderStatus\n                    \u2502\n                    \u251c\u2500\u2500 Read headers: Partyid, Carrierid\n                    \u251c\u2500\u2500 Find PartyRelationship (validates client, carrier)\n                    \u251c\u2500\u2500 Load settings: ShippingGatewayConfigId, ClientUrl, ClientOrderEndpoint, ClientAuthKey\n                    \u251c\u2500\u2500 Look up option: service.name.handle.webhook.response\n                    \u251c\u2500\u2500 Call handler service (parses carrier-specific webhook payload)\n                    \u2502     e.g. C807Services.handle#C807WebhookResponseHandler\n                    \u2502     \u2192 returns normalized responseMap\n                    \u2502\n                    \u2514\u2500\u2500 POST normalized responseMap to OFBiz:\n                          URL = settingsMap.ClientUrl + settingsMap.ClientOrderEndpoint\n                          Header: Authorization: Basic <ClientAuthKey>\n                          Body: JSON responseMap\n"})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Key data flow:"})}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Partyid"})," header \u2192 identifies the tenant (e.g., ",(0,s.jsx)(r.code,{children:"ADOC_SV"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Carrierid"})," header \u2192 identifies the carrier (e.g., ",(0,s.jsx)(r.code,{children:"C807"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["The webhook body is read raw via ",(0,s.jsx)(r.code,{children:"ec.web.getRequestBodyText()"})]}),"\n",(0,s.jsxs)(r.li,{children:["The response is forwarded to OFBiz at: ",(0,s.jsx)(r.code,{children:"ClientUrl + ClientOrderEndpoint"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["For ADOC_SV: ",(0,s.jsx)(r.code,{children:"https://adoc-sv-uat.hotwax.io/api/service/orderDeliveryStatus"})]}),"\n",(0,s.jsxs)(r.li,{children:["For ADOC_HN: ",(0,s.jsx)(r.code,{children:"https://adoc-hn-uat.hotwax.io/api/service/orderDeliveryStatus"})]}),"\n"]}),"\n"]}),"\n"]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"11-carrier-integration-details",children:"11. Carrier Integration Details"}),(0,s.jsx)(r.h3,{id:"carrier-inventory",children:"Carrier Inventory"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Carrier ID"}),(0,s.jsx)(r.th,{children:"Display Name"}),(0,s.jsx)(r.th,{children:"Country"}),(0,s.jsx)(r.th,{children:"Auth"}),(0,s.jsx)(r.th,{children:"Rate"}),(0,s.jsx)(r.th,{children:"Label"}),(0,s.jsx)(r.th,{children:"Void"}),(0,s.jsx)(r.th,{children:"Manifest"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"FORZA"})}),(0,s.jsx)(r.td,{children:"Forza"}),(0,s.jsx)(r.td,{children:"GT"}),(0,s.jsx)(r.td,{children:"HMAC+Base64"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2753"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"C807"})}),(0,s.jsx)(r.td,{children:"C807"}),(0,s.jsx)(r.td,{children:"HN, SV"}),(0,s.jsx)(r.td,{children:"OAuth2 Bearer"}),(0,s.jsx)(r.td,{children:"\u274c"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2705"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"TERMINAL_EXPRESS"})}),(0,s.jsx)(r.td,{children:"Terminal Express"}),(0,s.jsx)(r.td,{children:"CR"}),(0,s.jsx)(r.td,{children:"Basic Auth"}),(0,s.jsx)(r.td,{children:"\u274c"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u274c"}),(0,s.jsx)(r.td,{children:"\u274c"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"MOOVIN"})}),(0,s.jsx)(r.td,{children:"Moovin"}),(0,s.jsx)(r.td,{children:"GT"}),(0,s.jsx)(r.td,{children:"Basic/OAuth2"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2753"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"DRIVIN"})}),(0,s.jsx)(r.td,{children:"Drivin"}),(0,s.jsx)(r.td,{children:"GT, SV"}),(0,s.jsx)(r.td,{children:"Static Bearer"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2753"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"CARGOTRANS"})}),(0,s.jsx)(r.td,{children:"CargoTrans"}),(0,s.jsx)(r.td,{children:"GT"}),(0,s.jsx)(r.td,{children:"OAuth2"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2753"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"CITI_EXPRESS"})}),(0,s.jsx)(r.td,{children:"CitiExpress"}),(0,s.jsx)(r.td,{children:"-"}),(0,s.jsx)(r.td,{children:"API Key"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2705"}),(0,s.jsx)(r.td,{children:"\u2753"}),(0,s.jsx)(r.td,{children:"\u2753"})]})]})]}),(0,s.jsx)(r.h3,{id:"shippinggatewayconfig-per-carrier",children:"ShippingGatewayConfig per Carrier"}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Forza:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "FORZA"\ngetRateServiceName = "co.hotwax.shippingAggregator.forza.ForzaServices.get#ForzaShippingRate"\nrequestLabelsServiceName = "co.hotwax.shippingAggregator.forza.ForzaServices.request#ForzaShippingLabel"\nrefundLabelsServiceName = "co.hotwax.shippingAggregator.forza.ForzaServices.refund#ForzaShippingLabel"\n\nOptions:\n  endPoint = <Forza API base URL>\n  endPoint.accessToken = <token endpoint path>\n  endPoint.shipments.labels = <label path>\n  endPoint.shipments.void = <void path>\n  endPoint.shipment.rate = <rate path>\n  service.name.handle.get.label = ForzaServices.handle#ForzaLabelResponseHandler\n  service.name.handle.get.rate = ForzaServices.handle#ForzaRateResponseHandler\n  service.name.handle.void.label = ForzaServices.handle#ForzaVoidLabelResponseHandler\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"C807:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "C807"\nrequestLabelsServiceName = "co.hotwax.shippingAggregator.c807.C807Services.request#C807ShippingLabel"\nrefundLabelsServiceName = "co.hotwax.shippingAggregator.c807.C807Services.refund#C807ShippingLabel"\n\nOptions:\n  endPoint = <C807 API base URL>  (settingsMap.EndPoint per-relationship, OR optionsMap.endPoint)\n  endPoint.accessToken = <token path>\n  endPoint.shipments.labels = <label path>\n  endPoint.shipments.void = <void path>\n  endPoint.shipments.artifacts = <artifact/pdf path>\n  service.name.handle.get.label = C807Services.handle#C807LabelResponseHandler\n  service.name.handle.void.label = C807Services.handle#C807VoidLabelResponseHandler\n  service.name.handle.webhook.response = C807Services.handle#C807WebhookResponseHandler\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"TerminalExpress:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "TERMINAL_EXPRESS"\nrequestLabelsServiceName = "co.hotwax.shippingAggregator.terminalExpress.TerminalExpressServices.request#TerminalExpressShippingLabel"\n\nOptions:\n  endPoint = "https://sandboxlte.laterminalexpress.com/api/"\n  endPoint.shipments.labels = "Paquetes/crearOrden/"\n  service.name.handle.get.label = TerminalExpressServices.handle#TerminalExpressResponseHandler\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Moovin:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "MOOVIN"\npostOrderServiceName = "co.hotwax.shippingAggregator.moovin.MoovinServices.post#MoovinOrder"\ndeleteOrderServiceName = "co.hotwax.shippingAggregator.moovin.MoovinServices.delete#MoovinOrder"\n\nOptions:\n  endPoint = <Moovin API base URL>\n  endPoint.post.order = <post order path>\n  service.name.handle.post.order = MoovinServices.handle#MoovinHandlePostOrder\n  service.name.handle.delete.order = MoovinServices.handle#MoovinHandleDeleteOrder\n  service.name.handle.get.rate = MoovinServices.handle#MoovinHandleRateResponse\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.em,{children:["Note: Moovin uses the ",(0,s.jsx)(r.code,{children:"postOrder"}),"/",(0,s.jsx)(r.code,{children:"deleteOrder"})," paradigm instead of ",(0,s.jsx)(r.code,{children:"requestShippingLabel"}),"."]})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Drivin:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "DRIVIN"\npostOrderServiceName = "co.hotwax.shippingAggregator.drivIn.DrivInServices.post#DrivInpostOrder"\ndeleteOrderServiceName = "co.hotwax.shippingAggregator.drivIn.DrivInServices.delete#DrivInDeleteOrder"\n\nOptions:\n  endPoint = <Drivin API base URL>\n  endPoint.post.order = <post order path>\n  service.name.handle.post.order = DrivInServices.handle#DrivInHandlePostOrder\n  service.name.handle.delete.order = DrivInServices.handle#DrivInHandleDeleteOrder\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.em,{children:["Note: Uses an ",(0,s.jsx)(r.code,{children:"ApiToken"})," via the ",(0,s.jsx)(r.code,{children:"X-API-Key"})," header and dynamically queries for a ",(0,s.jsx)(r.code,{children:"schema_code"})," on post order."]})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"CargoTrans:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "CARGOTRANS"\ngetRateServiceName = "co.hotwax.shippingAggregator.cargoTrans.CargoTransServices.get#CargoTransShippingRate"\nrequestLabelsServiceName = "co.hotwax.shippingAggregator.cargoTrans.CargoTransServices.request#CargoTransShippingLabel"\n\nOptions:\n  endPoint = <CargoTrans API base URL>\n  endPoint.shipments.labels = <label creation path>\n  businessCategory.default = <category ID>\n  service.name.handle.get.label = CargoTransServices.handle#CargoTransLabelResponseHandler\n  service.name.handle.get.rate = CargoTransServices.handle#CargoTransRateResponseHandler\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.em,{children:["Note: Requires a ",(0,s.jsx)(r.code,{children:"ClientId"})," parameter in the payload body and a ",(0,s.jsx)(r.code,{children:"ClientSecretKey"})," for the ",(0,s.jsx)(r.code,{children:"X-API-Key"})," auth header. Also queries for a ",(0,s.jsx)(r.code,{children:"municipalityId"}),"."]})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"CitiExpress:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "CITI_EXPRESS"\npostOrderServiceName = "co.hotwax.shippingAggregator.citiExpress.CitiExpressServices.post#CitiExpressOrder"\ndeleteOrderServiceName = "co.hotwax.shippingAggregator.citiExpress.CitiExpressServices.delete#CitiExpressOrder"\n\nOptions:\n  endPoint = <CitiExpress API base URL>\n  endPoint.post.order = <post order path>\n  service.name.handle.post.order = CitiExpressServices.handle#CitiExpressHandlePostOrder\n  service.name.handle.delete.order = CitiExpressServices.handle#CitiExpressHandleDeleteOrder\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.em,{children:["Note: Passes the ",(0,s.jsx)(r.code,{children:"ApiKey"})," setting directly inside the JSON payload logic. Requires precise coordinate attributes (",(0,s.jsx)(r.code,{children:"job_pickup_latitude"})," / ",(0,s.jsx)(r.code,{children:"longitude"}),")."]})}),(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"FedEx:"})}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'shippingGatewayConfigId = "FEDEX"\ngetRateServiceName = "co.hotwax.shippingAggregator.Fedex.FedexServices.get#FedexShippingRate"\nrequestLabelsServiceName = "co.hotwax.shippingAggregator.Fedex.FedexServices.request#FedexShippingLabel"\nrefundLabelsServiceName = "co.hotwax.shippingAggregator.Fedex.FedexServices.refund#FedexShippingLabel"\n\nOptions:\n  endPoint = <FedEx API base URL>\n  endPoint.accessToken = <token path>\n  endPoint.shipments.labels = <label path>\n  endPoint.shipment.rate = <rate path>\n  service.name.handle.get.label = FedexServices.handle#FedexLabelResponseHandler\n  service.name.handle.get.rate = FedexServices.handle#FedexRateResponseHandler\n  service.name.handle.void.label = FedexServices.handle#FedexVoidLabelResponseHandler\n'})}),(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.em,{children:["Note: Implements standard OAuth2 (",(0,s.jsx)(r.code,{children:"client_credentials"}),") and caches the ",(0,s.jsx)(r.code,{children:"accessToken"}),". Distinct from others, deeply standardized shipping fields (e.g. ",(0,s.jsx)(r.code,{children:"LabelStockType"}),", dimensional units)."]})}),(0,s.jsx)(r.h3,{id:"adoc-client--carrier-relationships",children:"ADOC Client \u2192 Carrier Relationships"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Relationship ID"}),(0,s.jsx)(r.th,{children:"Client"}),(0,s.jsx)(r.th,{children:"Carrier"}),(0,s.jsx)(r.th,{children:"Auth Setting"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_FORZA"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"FORZA"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"ClientId=53489"}),", ",(0,s.jsx)(r.code,{children:"ClientSecretKey=..."}),", ",(0,s.jsx)(r.code,{children:"CodApp=..."}),", ",(0,s.jsx)(r.code,{children:"AccountNumber=..."})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_MOOVIN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"MOOVIN"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"Username=ADOC"}),", ",(0,s.jsx)(r.code,{children:"Password=..."})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_CARGO"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"CARGOTRANS"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"ClientId=2587"}),", ",(0,s.jsx)(r.code,{children:"ClientSecretKey=..."})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_TERMINAL_EXPRESS"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"TERMINAL_EXPRESS"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"ClientId=1506"}),", ",(0,s.jsx)(r.code,{children:"Username"}),", ",(0,s.jsx)(r.code,{children:"Password"}),", ",(0,s.jsx)(r.code,{children:"ReverseLogistics=N"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_CITI_EXPRESS"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"CITI_EXPRESS"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ApiKey=..."})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_DRIVIN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"DRIVIN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ApiToken=..."})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_C807"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"C807"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"Username"}),", ",(0,s.jsx)(r.code,{children:"Password"}),", ",(0,s.jsx)(r.code,{children:"EndPoint=https://app.c807.com/"}),", ",(0,s.jsx)(r.code,{children:"AuthType=BASIC_AUTH"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_SV_C807"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_SV"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"C807"})}),(0,s.jsxs)(r.td,{children:["same + ",(0,s.jsx)(r.code,{children:"ClientUrl"}),", ",(0,s.jsx)(r.code,{children:"ClientOrderEndpoint"}),", ",(0,s.jsx)(r.code,{children:"ClientAuthKey"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_SV_DRIVIN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_SV"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"DRIVIN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ApiToken=..."})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_HN_C807"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"ADOC_HN"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"C807"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"EndPoint=https://devapp.c807.com/"}),", ",(0,s.jsx)(r.code,{children:"ClientUrl=https://adoc-hn-uat.hotwax.io"})]})]})]})]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"12-error-handling--logging",children:"12. Error Handling & Logging"}),(0,s.jsx)(r.h3,{id:"validation-layer",children:"Validation Layer"}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"HelperServices.validate#RequiredParameters"})," (backed by ",(0,s.jsx)(r.code,{children:"validateRequiredParameters.groovy"}),"):"]}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Accepts a list of required field names and a parameters map"}),"\n",(0,s.jsxs)(r.li,{children:["Returns ",(0,s.jsx)(r.code,{children:"{success: true}"})," or ",(0,s.jsx)(r.code,{children:'{success: false, errorMessage: "Missing: field1, field2"}'})]}),"\n",(0,s.jsx)(r.li,{children:"Called at the generic level (address required) and at the carrier level (carrier-specific fields)"}),"\n"]}),(0,s.jsx)(r.h3,{id:"error-propagation-pattern",children:"Error Propagation Pattern"}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'Carrier service returns: { success: false, errorMessages: [...] }\n   \u2192 parent service returns: { success: false, errorMessages: [...] }\n   \u2192 GenericShippingServices returns: responseMap with success=false\n   \u2192 OFBiz receives JSON: { "success": false, "errorMessages": "..." }\n'})}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Forza-specific:"})," Wraps restClient.call() in try/catch:"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-groovy",children:'catch (Exception e) {\n    ec.logger.error("DIAGNOSTIC: Error calling Forza Label API: ${e.getMessage()}", e)\n    errorMessages.add("Unable to make request to Forza. Error: ${e.getMessage()}")\n    return [success: false, errorMessages: errorMessages]\n}\n'})}),(0,s.jsx)(r.h3,{id:"logging-conventions",children:"Logging Conventions"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Log Level"}),(0,s.jsx)(r.th,{children:"When Used"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"warn"})}),(0,s.jsx)(r.td,{children:"Diagnostic logs (currently active in most carrier files)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"warn"})}),(0,s.jsx)(r.td,{children:"HTTP non-2xx response codes"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"info"})}),(0,s.jsx)(r.td,{children:'Service call tracking ("Calling service ...", "Response returned for ...")'})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"error"})}),(0,s.jsx)(r.td,{children:"Exceptions caught in try/catch"})]})]})]}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Diagnostic logging"})," (added during debugging, currently active):"]}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"DIAGNOSTIC: Terminal Express start for configId: ..."})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"DIAGNOSTIC: C807 Request Body: ..."})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"DIAGNOSTIC: Forza Label Response Code: ..."})}),"\n"]}),(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"\u26a0\ufe0f These WARN-level diagnostic logs are verbose. They should be removed or changed to DEBUG before production."}),"\n"]}),(0,s.jsx)(r.h3,{id:"http-status-handling",children:"HTTP Status Handling"}),(0,s.jsx)(r.p,{children:"All carrier services follow this pattern:"}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-groovy",children:'if (restResponse.statusCode < 200 || restResponse.statusCode >= 300) {\n    ec.logger.warn("Unsuccessful with status code: ${restResponse.statusCode} and response: ${restResponse.text()}")\n}\n// response is still parsed \u2014 carrier may include error details in 4xx body\nMap responseMap = restResponse.jsonObject()\nreturn responseMap\n'})}),(0,s.jsxs)(r.p,{children:["The carrier service does ",(0,s.jsx)(r.strong,{children:"not throw exceptions"})," for HTTP errors \u2014 it returns the parsed JSON body (which may contain carrier-specific error fields). The handler and OFBiz are responsible for interpreting these."]}),(0,s.jsx)(r.hr,{}),(0,s.jsx)(r.h2,{id:"13-configuration-reference",children:"13. Configuration Reference"}),(0,s.jsx)(r.h3,{id:"how-to-add-a-new-carrier",children:"How to Add a New Carrier"}),(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Create Party:"})," Add ",(0,s.jsx)(r.code,{children:"mantle.party.Party"})," with ",(0,s.jsx)(r.code,{children:'partyTypeEnumId="PtyOrganization"'})," and ",(0,s.jsx)(r.code,{children:'roleTypeId="Carrier"'})]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Create ShippingGatewayConfig:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xml",children:'<ShippingGatewayConfig shippingGatewayConfigId="NEW_CARRIER"\n  shippingGatewayTypeEnumId="ShGtwyTrdPrty"\n  requestLabelsServiceName="co.hotwax.shippingAggregator.newcarrier.NewCarrierServices.request#NewCarrierLabel"/>\n'})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Add ShippingGatewayOptions:"})," Endpoints + handler service names"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Create PartyRelationship:"})," Link client party (e.g., ",(0,s.jsx)(r.code,{children:"ADOC"}),") to the new carrier"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Add PartyRelationshipSettings:"})," Credentials + ",(0,s.jsx)(r.code,{children:"ShippingGatewayConfigId"})]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Implement Groovy service:"})," Create ",(0,s.jsx)(r.code,{children:"service/co/hotwax/shippingAggregator/newcarrier/"})," with label/rate/refund groovy scripts"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Register in XML:"})," Create ",(0,s.jsx)(r.code,{children:"NewCarrierServices.xml"})," wrapping the groovy scripts"]}),"\n"]}),"\n"]}),(0,s.jsx)(r.h3,{id:"endpoint-url-resolution-priority-order",children:"Endpoint URL Resolution (Priority Order)"}),(0,s.jsx)(r.p,{children:"For most carriers, the base URL is determined as follows:"}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-groovy",children:'def baseUrl = settingsMap.containsKey("EndPoint") ? settingsMap.EndPoint : optionsMap.endPoint\n'})}),(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"settingsMap.EndPoint"})," (from ",(0,s.jsx)(r.code,{children:"PartyRelationshipSetting"}),") ",(0,s.jsx)(r.strong,{children:"overrides"})," ",(0,s.jsx)(r.code,{children:"optionsMap.endPoint"})," (from ",(0,s.jsx)(r.code,{children:"ShippingGatewayOption"}),"). This allows per-relationship URL customization without changing the gateway config (e.g., production vs. dev endpoints for different ADOC instances)."]}),(0,s.jsx)(r.h3,{id:"key-service-dependencies",children:"Key Service Dependencies"}),(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Utility Class"}),(0,s.jsx)(r.th,{children:"Location"}),(0,s.jsx)(r.th,{children:"Purpose"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"co.hotwax.helper.ShippingAggregatorHelper"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"src/"})," directory"]}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"getShippingGatewayConfigOptions()"}),", ",(0,s.jsx)(r.code,{children:"getPartyRelationshipSettings()"}),", ",(0,s.jsx)(r.code,{children:"getFieldsMapFromList()"}),", ",(0,s.jsx)(r.code,{children:"mapToBase64()"}),", ",(0,s.jsx)(r.code,{children:"decodePayLoad()"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"co.hotwax.helper.LauValueGenerator"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"src/"})," directory"]}),(0,s.jsx)(r.td,{children:"HMAC-SHA256 signature generation for Forza"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"org.moqui.util.RestClient"})}),(0,s.jsx)(r.td,{children:"Moqui framework"}),(0,s.jsx)(r.td,{children:"HTTP client for all carrier API calls"})]})]})]})]})]})}function v(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},9365(e,r,i){i.d(r,{A:()=>t});i(6540);var n=i(4164);const s="tabItem_Ymn6";var d=i(4848);function t({children:e,hidden:r,className:i}){return(0,d.jsx)("div",{role:"tabpanel",className:(0,n.A)(s,i),hidden:r,children:e})}},1470(e,r,i){i.d(r,{A:()=>A});var n=i(6540),s=i(4164),d=i(7559),t=i(3104),c=i(6347),l=i(205),a=i(7485),o=i(1682),h=i(679);function x(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:r}=e;return!!r&&"object"==typeof r&&"value"in r}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function j(e){const{values:r,children:i}=e;return(0,n.useMemo)(()=>{const e=r??function(e){return x(e).map(({props:{value:e,label:r,attributes:i,default:n}})=>({value:e,label:r,attributes:i,default:n}))}(i);return function(e){const r=(0,o.XI)(e,(e,r)=>e.value===r.value);if(r.length>0)throw new Error(`Docusaurus error: Duplicate values "${r.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[r,i])}function p({value:e,tabValues:r}){return r.some(r=>r.value===e)}function u({queryString:e=!1,groupId:r}){const i=(0,c.W6)(),s=function({queryString:e=!1,groupId:r}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:e,groupId:r});return[(0,a.aZ)(s),(0,n.useCallback)(e=>{if(!s)return;const r=new URLSearchParams(i.location.search);r.set(s,e),i.replace({...i.location,search:r.toString()})},[s,i])]}function g(e){const{defaultValue:r,queryString:i=!1,groupId:s}=e,d=j(e),[t,c]=(0,n.useState)(()=>function({defaultValue:e,tabValues:r}){if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${r.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const i=r.find(e=>e.default)??r[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:r,tabValues:d})),[a,o]=u({queryString:i,groupId:s}),[x,g]=function({groupId:e}){const r=function(e){return e?`docusaurus.tab.${e}`:null}(e),[i,s]=(0,h.Dv)(r);return[i,(0,n.useCallback)(e=>{r&&s.set(e)},[r,s])]}({groupId:s}),m=(()=>{const e=a??x;return p({value:e,tabValues:d})?e:null})();(0,l.A)(()=>{m&&c(m)},[m]);return{selectedValue:t,selectValue:(0,n.useCallback)(e=>{if(!p({value:e,tabValues:d}))throw new Error(`Can't select invalid tab value=${e}`);c(e),o(e),g(e)},[o,g,d]),tabValues:d}}var m=i(2303);const v="tabList__CuJ",y="tabItem_LNqP";var S=i(4848);function f({className:e,block:r,selectedValue:i,selectValue:n,tabValues:d}){const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,t.a_)(),a=e=>{const r=e.currentTarget,s=c.indexOf(r),t=d[s].value;t!==i&&(l(r),n(t))},o=e=>{let r=null;switch(e.key){case"Enter":a(e);break;case"ArrowRight":{const i=c.indexOf(e.currentTarget)+1;r=c[i]??c[0];break}case"ArrowLeft":{const i=c.indexOf(e.currentTarget)-1;r=c[i]??c[c.length-1];break}}r?.focus()};return(0,S.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},e),children:d.map(({value:e,label:r,attributes:n})=>(0,S.jsx)("li",{role:"tab",tabIndex:i===e?0:-1,"aria-selected":i===e,ref:e=>{c.push(e)},onKeyDown:o,onClick:a,...n,className:(0,s.A)("tabs__item",y,n?.className,{"tabs__item--active":i===e}),children:r??e},e))})}function C({lazy:e,children:r,selectedValue:i}){const d=(Array.isArray(r)?r:[r]).filter(Boolean);if(e){const e=d.find(e=>e.props.value===i);return e?(0,n.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,S.jsx)("div",{className:"margin-top--md",children:d.map((e,r)=>(0,n.cloneElement)(e,{key:r,hidden:e.props.value!==i}))})}function b(e){const r=g(e);return(0,S.jsxs)("div",{className:(0,s.A)(d.G.tabs.container,"tabs-container",v),children:[(0,S.jsx)(f,{...r,...e}),(0,S.jsx)(C,{...r,...e})]})}function A(e){const r=(0,m.A)();return(0,S.jsx)(b,{...e,children:x(e.children)},String(r))}},4923(e,r,i){i.d(r,{A:()=>t});i(6540);var n=i(8478),s=i(4848);function d(){return(0,s.jsx)("button",{onClick:async()=>{const e=(await i.e(3833).then(i.t.bind(i,3833,23))).default,r=document.getElementById("printable-content");e().set({margin:10,filename:"adoc-webhook-integration.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).from(r).save()},className:"button button--primary",style:{float:"right",marginLeft:"10px",marginBottom:"10px"},children:"Download Report PDF"})}function t(){return(0,s.jsx)(n.A,{children:()=>(0,s.jsx)(d,{})})}}}]);